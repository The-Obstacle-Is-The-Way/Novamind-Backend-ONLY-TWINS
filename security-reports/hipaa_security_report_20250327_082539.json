{
  "timestamp": "2025-03-27T08:25:39.887282",
  "results": [
    {
      "test_file": "test_api_security.py",
      "passed": false,
      "total_tests": 0,
      "passed_tests": 0,
      "failed_tests": 0,
      "skipped_tests": 0,
      "duration": 2.187161684036255,
      "stdout": "============================= test session starts =============================\ncollecting ... collected 0 items / 1 error\n\n=================================== ERRORS ====================================\n____________ ERROR collecting tests/security/test_api_security.py _____________\nImportError while importing test module '\\\\wsl$\\Ubuntu-22.04\\home\\jj\\dev\\Novamind-Backend\\tests\\security\\test_api_security.py'.\nHint: make sure your test modules/packages have valid Python names.\nTraceback:\nC:\\Program Files\\Python311\\Lib\\importlib\\__init__.py:126: in import_module\n    return _bootstrap._gcd_import(name[level:], package, level)\nC:\\Program Files\\Python311\\Lib\\site-packages\\ddtrace\\internal\\module.py:295: in _exec_module\n    self.loader.exec_module(module)\ntests\\security\\test_api_security.py:18: in <module>\n    from app.main import app\nE   ModuleNotFoundError: No module named 'app.main'\n=========================== short test summary info ===========================\nERROR tests/security/test_api_security.py\n!!!!!!!!!!!!!!!!!!! Interrupted: 1 error during collection !!!!!!!!!!!!!!!!!!!!\n============================== 1 error in 0.30s ===============================\n",
      "stderr": "C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\pytest_asyncio\\plugin.py:207: PytestDeprecationWarning: The configuration option \"asyncio_default_fixture_loop_scope\" is unset.\nThe event loop scope for asynchronous fixtures will default to the fixture caching scope. Future versions of pytest-asyncio will default the loop scope for asynchronous fixtures to function scope. Set the default fixture loop scope explicitly in order to avoid unexpected behavior in the future. Valid fixture loop scopes are: \"function\", \"class\", \"module\", \"package\", \"session\"\n\n  warnings.warn(PytestDeprecationWarning(_DEFAULT_FIXTURE_LOOP_SCOPE_UNSET))\n"
    },
    {
      "test_file": "test_audit_logging.py",
      "passed": true,
      "total_tests": 10,
      "passed_tests": 0,
      "failed_tests": 0,
      "skipped_tests": 5,
      "duration": 1.665215015411377,
      "stdout": "============================= test session starts =============================\ncollecting ... collected 5 items\n\ntests/security/test_audit_logging.py::TestAuditLogging::test_log_phi_access SKIPPED [ 20%]\ntests/security/test_audit_logging.py::TestAuditLogging::test_search_audit_logs SKIPPED [ 40%]\ntests/security/test_audit_logging.py::TestAuditLogging::test_tamper_resistance SKIPPED [ 60%]\ntests/security/test_audit_logging.py::TestAuditLogging::test_log_security SKIPPED [ 80%]\ntests/security/test_audit_logging.py::TestAuditLogging::test_log_export SKIPPED [100%]\n\n============================= 5 skipped in 0.14s ==============================\n",
      "stderr": "C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\pytest_asyncio\\plugin.py:207: PytestDeprecationWarning: The configuration option \"asyncio_default_fixture_loop_scope\" is unset.\nThe event loop scope for asynchronous fixtures will default to the fixture caching scope. Future versions of pytest-asyncio will default the loop scope for asynchronous fixtures to function scope. Set the default fixture loop scope explicitly in order to avoid unexpected behavior in the future. Valid fixture loop scopes are: \"function\", \"class\", \"module\", \"package\", \"session\"\n\n  warnings.warn(PytestDeprecationWarning(_DEFAULT_FIXTURE_LOOP_SCOPE_UNSET))\n"
    },
    {
      "test_file": "test_auth_middleware.py",
      "passed": false,
      "total_tests": 66,
      "passed_tests": 1,
      "failed_tests": 32,
      "skipped_tests": 0,
      "duration": 3.7895350456237793,
      "stdout": "============================= test session starts =============================\ncollecting ... collected 17 items\n\ntests/security/test_auth_middleware.py::TestAuthMiddleware::test_public_route_access PASSED [  5%]\ntests/security/test_auth_middleware.py::TestAuthMiddleware::test_patient_route_without_token FAILED [ 11%]\ntests/security/test_auth_middleware.py::TestAuthMiddleware::test_patient_route_with_patient_token FAILED [ 17%]\ntests/security/test_auth_middleware.py::TestAuthMiddleware::test_patient_route_with_provider_token FAILED [ 23%]\ntests/security/test_auth_middleware.py::TestAuthMiddleware::test_provider_route_with_patient_token FAILED [ 29%]\ntests/security/test_auth_middleware.py::TestAuthMiddleware::test_provider_route_with_provider_token FAILED [ 35%]\ntests/security/test_auth_middleware.py::TestAuthMiddleware::test_admin_route_with_provider_token FAILED [ 41%]\ntests/security/test_auth_middleware.py::TestAuthMiddleware::test_admin_route_with_admin_token FAILED [ 47%]\ntests/security/test_auth_middleware.py::TestAuthMiddleware::test_expired_token FAILED [ 52%]\ntests/security/test_auth_middleware.py::TestAuthMiddleware::test_invalid_token FAILED [ 58%]\ntests/security/test_auth_middleware.py::TestAuthMiddleware::test_patient_accessing_own_data FAILED [ 64%]\ntests/security/test_auth_middleware.py::TestAuthMiddleware::test_patient_accessing_other_patient_data FAILED [ 70%]\ntests/security/test_auth_middleware.py::TestAuthMiddleware::test_provider_accessing_patient_data FAILED [ 76%]\ntests/security/test_auth_middleware.py::TestAuthMiddleware::test_malformed_authorization_header FAILED [ 82%]\ntests/security/test_auth_middleware.py::TestAuthMiddleware::test_rate_limiting FAILED [ 88%]\ntests/security/test_auth_middleware.py::TestAuthMiddleware::test_csrf_protection FAILED [ 94%]\ntests/security/test_auth_middleware.py::TestAuthMiddleware::test_logging_of_access_attempts FAILED [100%]\n\n================================== FAILURES ===================================\n_____________ TestAuthMiddleware.test_patient_route_without_token _____________\n  + Exception Group Traceback (most recent call last):\n  |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\_backends\\_asyncio.py\", line 763, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\runner.py\", line 341, in from_call\n    |     result: TResult | None = func()\n    |                              ^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\runner.py\", line 242, in <lambda>\n    |     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_hooks.py\", line 513, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 139, in _multicall\n    |     raise exception.with_traceback(exception.__traceback__)\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\threadexception.py\", line 92, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\threadexception.py\", line 68, in thread_exception_runtest_hook\n    |     yield\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\unraisableexception.py\", line 95, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\unraisableexception.py\", line 70, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\logging.py\", line 846, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\logging.py\", line 829, in _runtest_for\n    |     yield\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\capture.py\", line 898, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 103, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\runner.py\", line 174, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\python.py\", line 1627, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_hooks.py\", line 513, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 182, in _multicall\n    |     return outcome.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_result.py\", line 100, in get_result\n    |     raise exc.with_traceback(exc.__traceback__)\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 103, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\python.py\", line 159, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"\\\\wsl$\\Ubuntu-22.04\\home\\jj\\dev\\Novamind-Backend\\tests\\security\\test_auth_middleware.py\", line 146, in test_patient_route_without_token\n    |     response = test_client.get(\"/patient-only\")\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py\", line 502, in get\n    |     return super().get(\n    |            ^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 1041, in get\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 814, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 901, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 929, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 966, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 1002, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\from_thread.py\", line 290, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\concurrent\\futures\\_base.py\", line 449, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\concurrent\\futures\\_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\from_thread.py\", line 221, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\fastapi\\applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"C:\\Program Files\\Python311\\Lib\\contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(typ, value, traceback)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"\\\\wsl$\\Ubuntu-22.04\\home\\jj\\dev\\Novamind-Backend\\app\\infrastructure\\security\\auth_middleware.py\", line 212, in dispatch\n    |     raise HTTPException(\n    | fastapi.exceptions.HTTPException: 401: Not authenticated\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\ntests\\security\\test_auth_middleware.py:146: in test_patient_route_without_token\n    response = test_client.get(\"/patient-only\")\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py:502: in get\n    return super().get(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:1041: in get\n    return self.request(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py:468: in request\n    return super().request(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:814: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:901: in send\n    response = self._send_handling_auth(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:929: in _send_handling_auth\n    response = self._send_handling_redirects(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:966: in _send_handling_redirects\n    response = self._send_single_request(request)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:1002: in _send_single_request\n    response = transport.handle_request(request)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py:344: in handle_request\n    raise exc\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\from_thread.py:290: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\nC:\\Program Files\\Python311\\Lib\\concurrent\\futures\\_base.py:449: in result\n    return self.__get_result()\nC:\\Program Files\\Python311\\Lib\\concurrent\\futures\\_base.py:401: in __get_result\n    raise self._exception\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\from_thread.py:221: in _call_func\n    retval = await retval_or_awaitable\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\fastapi\\applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\errors.py:186: in __call__\n    raise exc\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py:189: in __call__\n    with collapse_excgroups():\nC:\\Program Files\\Python311\\Lib\\contextlib.py:158: in __exit__\n    self.gen.throw(typ, value, traceback)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\_utils.py:91: in collapse_excgroups\n    raise exc\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\napp\\infrastructure\\security\\auth_middleware.py:212: in dispatch\n    raise HTTPException(\nE   fastapi.exceptions.HTTPException: 401: Not authenticated\n------------------------------ Captured log call ------------------------------\nWARNING  app.infrastructure.security.auth_middleware:auth_middleware.py:252 Authentication error: 401 - Not authenticated\n__________ TestAuthMiddleware.test_patient_route_with_patient_token ___________\n  + Exception Group Traceback (most recent call last):\n  |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\_backends\\_asyncio.py\", line 763, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\runner.py\", line 341, in from_call\n    |     result: TResult | None = func()\n    |                              ^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\runner.py\", line 242, in <lambda>\n    |     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_hooks.py\", line 513, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 139, in _multicall\n    |     raise exception.with_traceback(exception.__traceback__)\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\threadexception.py\", line 92, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\threadexception.py\", line 68, in thread_exception_runtest_hook\n    |     yield\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\unraisableexception.py\", line 95, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\unraisableexception.py\", line 70, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\logging.py\", line 846, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\logging.py\", line 829, in _runtest_for\n    |     yield\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\capture.py\", line 898, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 103, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\runner.py\", line 174, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\python.py\", line 1627, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_hooks.py\", line 513, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 182, in _multicall\n    |     return outcome.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_result.py\", line 100, in get_result\n    |     raise exc.with_traceback(exc.__traceback__)\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 103, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\python.py\", line 159, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"\\\\wsl$\\Ubuntu-22.04\\home\\jj\\dev\\Novamind-Backend\\tests\\security\\test_auth_middleware.py\", line 154, in test_patient_route_with_patient_token\n    |     response = test_client.get(\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py\", line 502, in get\n    |     return super().get(\n    |            ^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 1041, in get\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 814, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 901, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 929, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 966, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 1002, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\from_thread.py\", line 290, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\concurrent\\futures\\_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\concurrent\\futures\\_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\from_thread.py\", line 221, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\fastapi\\applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"C:\\Program Files\\Python311\\Lib\\contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(typ, value, traceback)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"\\\\wsl$\\Ubuntu-22.04\\home\\jj\\dev\\Novamind-Backend\\app\\infrastructure\\security\\auth_middleware.py\", line 229, in dispatch\n    |     raise HTTPException(\n    | fastapi.exceptions.HTTPException: 401: Invalid authentication credentials\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\ntests\\security\\test_auth_middleware.py:154: in test_patient_route_with_patient_token\n    response = test_client.get(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py:502: in get\n    return super().get(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:1041: in get\n    return self.request(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py:468: in request\n    return super().request(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:814: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:901: in send\n    response = self._send_handling_auth(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:929: in _send_handling_auth\n    response = self._send_handling_redirects(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:966: in _send_handling_redirects\n    response = self._send_single_request(request)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:1002: in _send_single_request\n    response = transport.handle_request(request)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py:344: in handle_request\n    raise exc\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\from_thread.py:290: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\nC:\\Program Files\\Python311\\Lib\\concurrent\\futures\\_base.py:456: in result\n    return self.__get_result()\nC:\\Program Files\\Python311\\Lib\\concurrent\\futures\\_base.py:401: in __get_result\n    raise self._exception\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\from_thread.py:221: in _call_func\n    retval = await retval_or_awaitable\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\fastapi\\applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\errors.py:186: in __call__\n    raise exc\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py:189: in __call__\n    with collapse_excgroups():\nC:\\Program Files\\Python311\\Lib\\contextlib.py:158: in __exit__\n    self.gen.throw(typ, value, traceback)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\_utils.py:91: in collapse_excgroups\n    raise exc\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\napp\\infrastructure\\security\\auth_middleware.py:229: in dispatch\n    raise HTTPException(\nE   fastapi.exceptions.HTTPException: 401: Invalid authentication credentials\n---------------------------- Captured stderr call -----------------------------\n[REDACTED:DATE] 08:25:19,316 - jwt_service - WARNING - JWT validation error: DecodeError\n------------------------------ Captured log call ------------------------------\nWARNING  jwt_service:phi_logger.py:94 JWT validation error: DecodeError\nWARNING  app.infrastructure.security.auth_middleware:auth_middleware.py:252 Authentication error: 401 - Invalid authentication credentials\n__________ TestAuthMiddleware.test_patient_route_with_provider_token __________\n  + Exception Group Traceback (most recent call last):\n  |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\_backends\\_asyncio.py\", line 763, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\runner.py\", line 341, in from_call\n    |     result: TResult | None = func()\n    |                              ^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\runner.py\", line 242, in <lambda>\n    |     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_hooks.py\", line 513, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 139, in _multicall\n    |     raise exception.with_traceback(exception.__traceback__)\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\threadexception.py\", line 92, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\threadexception.py\", line 68, in thread_exception_runtest_hook\n    |     yield\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\unraisableexception.py\", line 95, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\unraisableexception.py\", line 70, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\logging.py\", line 846, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\logging.py\", line 829, in _runtest_for\n    |     yield\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\capture.py\", line 898, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 103, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\runner.py\", line 174, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\python.py\", line 1627, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_hooks.py\", line 513, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 182, in _multicall\n    |     return outcome.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_result.py\", line 100, in get_result\n    |     raise exc.with_traceback(exc.__traceback__)\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 103, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\python.py\", line 159, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"\\\\wsl$\\Ubuntu-22.04\\home\\jj\\dev\\Novamind-Backend\\tests\\security\\test_auth_middleware.py\", line 166, in test_patient_route_with_provider_token\n    |     response = test_client.get(\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py\", line 502, in get\n    |     return super().get(\n    |            ^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 1041, in get\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 814, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 901, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 929, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 966, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 1002, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\from_thread.py\", line 290, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\concurrent\\futures\\_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\concurrent\\futures\\_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\from_thread.py\", line 221, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\fastapi\\applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"C:\\Program Files\\Python311\\Lib\\contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(typ, value, traceback)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"\\\\wsl$\\Ubuntu-22.04\\home\\jj\\dev\\Novamind-Backend\\app\\infrastructure\\security\\auth_middleware.py\", line 229, in dispatch\n    |     raise HTTPException(\n    | fastapi.exceptions.HTTPException: 401: Invalid authentication credentials\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\ntests\\security\\test_auth_middleware.py:166: in test_patient_route_with_provider_token\n    response = test_client.get(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py:502: in get\n    return super().get(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:1041: in get\n    return self.request(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py:468: in request\n    return super().request(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:814: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:901: in send\n    response = self._send_handling_auth(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:929: in _send_handling_auth\n    response = self._send_handling_redirects(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:966: in _send_handling_redirects\n    response = self._send_single_request(request)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:1002: in _send_single_request\n    response = transport.handle_request(request)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py:344: in handle_request\n    raise exc\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\from_thread.py:290: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\nC:\\Program Files\\Python311\\Lib\\concurrent\\futures\\_base.py:456: in result\n    return self.__get_result()\nC:\\Program Files\\Python311\\Lib\\concurrent\\futures\\_base.py:401: in __get_result\n    raise self._exception\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\from_thread.py:221: in _call_func\n    retval = await retval_or_awaitable\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\fastapi\\applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\errors.py:186: in __call__\n    raise exc\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py:189: in __call__\n    with collapse_excgroups():\nC:\\Program Files\\Python311\\Lib\\contextlib.py:158: in __exit__\n    self.gen.throw(typ, value, traceback)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\_utils.py:91: in collapse_excgroups\n    raise exc\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\napp\\infrastructure\\security\\auth_middleware.py:229: in dispatch\n    raise HTTPException(\nE   fastapi.exceptions.HTTPException: 401: Invalid authentication credentials\n---------------------------- Captured stderr call -----------------------------\n[REDACTED:DATE] 08:25:19,405 - jwt_service - WARNING - JWT validation error: DecodeError\n------------------------------ Captured log call ------------------------------\nWARNING  jwt_service:phi_logger.py:94 JWT validation error: DecodeError\nWARNING  app.infrastructure.security.auth_middleware:auth_middleware.py:252 Authentication error: 401 - Invalid authentication credentials\n__________ TestAuthMiddleware.test_provider_route_with_patient_token __________\n  + Exception Group Traceback (most recent call last):\n  |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\_backends\\_asyncio.py\", line 763, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\runner.py\", line 341, in from_call\n    |     result: TResult | None = func()\n    |                              ^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\runner.py\", line 242, in <lambda>\n    |     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_hooks.py\", line 513, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 139, in _multicall\n    |     raise exception.with_traceback(exception.__traceback__)\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\threadexception.py\", line 92, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\threadexception.py\", line 68, in thread_exception_runtest_hook\n    |     yield\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\unraisableexception.py\", line 95, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\unraisableexception.py\", line 70, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\logging.py\", line 846, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\logging.py\", line 829, in _runtest_for\n    |     yield\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\capture.py\", line 898, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 103, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\runner.py\", line 174, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\python.py\", line 1627, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_hooks.py\", line 513, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 182, in _multicall\n    |     return outcome.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_result.py\", line 100, in get_result\n    |     raise exc.with_traceback(exc.__traceback__)\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 103, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\python.py\", line 159, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"\\\\wsl$\\Ubuntu-22.04\\home\\jj\\dev\\Novamind-Backend\\tests\\security\\test_auth_middleware.py\", line 178, in test_provider_route_with_patient_token\n    |     response = test_client.get(\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py\", line 502, in get\n    |     return super().get(\n    |            ^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 1041, in get\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 814, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 901, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 929, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 966, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 1002, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\from_thread.py\", line 290, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\concurrent\\futures\\_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\concurrent\\futures\\_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\from_thread.py\", line 221, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\fastapi\\applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"C:\\Program Files\\Python311\\Lib\\contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(typ, value, traceback)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"\\\\wsl$\\Ubuntu-22.04\\home\\jj\\dev\\Novamind-Backend\\app\\infrastructure\\security\\auth_middleware.py\", line 229, in dispatch\n    |     raise HTTPException(\n    | fastapi.exceptions.HTTPException: 401: Invalid authentication credentials\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\ntests\\security\\test_auth_middleware.py:178: in test_provider_route_with_patient_token\n    response = test_client.get(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py:502: in get\n    return super().get(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:1041: in get\n    return self.request(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py:468: in request\n    return super().request(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:814: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:901: in send\n    response = self._send_handling_auth(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:929: in _send_handling_auth\n    response = self._send_handling_redirects(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:966: in _send_handling_redirects\n    response = self._send_single_request(request)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:1002: in _send_single_request\n    response = transport.handle_request(request)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py:344: in handle_request\n    raise exc\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\from_thread.py:290: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\nC:\\Program Files\\Python311\\Lib\\concurrent\\futures\\_base.py:456: in result\n    return self.__get_result()\nC:\\Program Files\\Python311\\Lib\\concurrent\\futures\\_base.py:401: in __get_result\n    raise self._exception\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\from_thread.py:221: in _call_func\n    retval = await retval_or_awaitable\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\fastapi\\applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\errors.py:186: in __call__\n    raise exc\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py:189: in __call__\n    with collapse_excgroups():\nC:\\Program Files\\Python311\\Lib\\contextlib.py:158: in __exit__\n    self.gen.throw(typ, value, traceback)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\_utils.py:91: in collapse_excgroups\n    raise exc\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\napp\\infrastructure\\security\\auth_middleware.py:229: in dispatch\n    raise HTTPException(\nE   fastapi.exceptions.HTTPException: 401: Invalid authentication credentials\n---------------------------- Captured stderr call -----------------------------\n[REDACTED:DATE] 08:25:19,510 - jwt_service - WARNING - JWT validation error: DecodeError\n------------------------------ Captured log call ------------------------------\nWARNING  jwt_service:phi_logger.py:94 JWT validation error: DecodeError\nWARNING  app.infrastructure.security.auth_middleware:auth_middleware.py:252 Authentication error: 401 - Invalid authentication credentials\n_________ TestAuthMiddleware.test_provider_route_with_provider_token __________\n  + Exception Group Traceback (most recent call last):\n  |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\_backends\\_asyncio.py\", line 763, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\runner.py\", line 341, in from_call\n    |     result: TResult | None = func()\n    |                              ^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\runner.py\", line 242, in <lambda>\n    |     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_hooks.py\", line 513, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 139, in _multicall\n    |     raise exception.with_traceback(exception.__traceback__)\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\threadexception.py\", line 92, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\threadexception.py\", line 68, in thread_exception_runtest_hook\n    |     yield\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\unraisableexception.py\", line 95, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\unraisableexception.py\", line 70, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\logging.py\", line 846, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\logging.py\", line 829, in _runtest_for\n    |     yield\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\capture.py\", line 898, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 103, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\runner.py\", line 174, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\python.py\", line 1627, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_hooks.py\", line 513, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 182, in _multicall\n    |     return outcome.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_result.py\", line 100, in get_result\n    |     raise exc.with_traceback(exc.__traceback__)\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 103, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\python.py\", line 159, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"\\\\wsl$\\Ubuntu-22.04\\home\\jj\\dev\\Novamind-Backend\\tests\\security\\test_auth_middleware.py\", line 189, in test_provider_route_with_provider_token\n    |     response = test_client.get(\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py\", line 502, in get\n    |     return super().get(\n    |            ^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 1041, in get\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 814, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 901, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 929, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 966, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 1002, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\from_thread.py\", line 290, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\concurrent\\futures\\_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\concurrent\\futures\\_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\from_thread.py\", line 221, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\fastapi\\applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"C:\\Program Files\\Python311\\Lib\\contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(typ, value, traceback)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"\\\\wsl$\\Ubuntu-22.04\\home\\jj\\dev\\Novamind-Backend\\app\\infrastructure\\security\\auth_middleware.py\", line 229, in dispatch\n    |     raise HTTPException(\n    | fastapi.exceptions.HTTPException: 401: Invalid authentication credentials\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\ntests\\security\\test_auth_middleware.py:189: in test_provider_route_with_provider_token\n    response = test_client.get(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py:502: in get\n    return super().get(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:1041: in get\n    return self.request(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py:468: in request\n    return super().request(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:814: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:901: in send\n    response = self._send_handling_auth(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:929: in _send_handling_auth\n    response = self._send_handling_redirects(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:966: in _send_handling_redirects\n    response = self._send_single_request(request)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:1002: in _send_single_request\n    response = transport.handle_request(request)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py:344: in handle_request\n    raise exc\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\from_thread.py:290: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\nC:\\Program Files\\Python311\\Lib\\concurrent\\futures\\_base.py:456: in result\n    return self.__get_result()\nC:\\Program Files\\Python311\\Lib\\concurrent\\futures\\_base.py:401: in __get_result\n    raise self._exception\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\from_thread.py:221: in _call_func\n    retval = await retval_or_awaitable\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\fastapi\\applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\errors.py:186: in __call__\n    raise exc\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py:189: in __call__\n    with collapse_excgroups():\nC:\\Program Files\\Python311\\Lib\\contextlib.py:158: in __exit__\n    self.gen.throw(typ, value, traceback)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\_utils.py:91: in collapse_excgroups\n    raise exc\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\napp\\infrastructure\\security\\auth_middleware.py:229: in dispatch\n    raise HTTPException(\nE   fastapi.exceptions.HTTPException: 401: Invalid authentication credentials\n---------------------------- Captured stderr call -----------------------------\n[REDACTED:DATE] 08:25:19,595 - jwt_service - WARNING - JWT validation error: DecodeError\n------------------------------ Captured log call ------------------------------\nWARNING  jwt_service:phi_logger.py:94 JWT validation error: DecodeError\nWARNING  app.infrastructure.security.auth_middleware:auth_middleware.py:252 Authentication error: 401 - Invalid authentication credentials\n___________ TestAuthMiddleware.test_admin_route_with_provider_token ___________\n  + Exception Group Traceback (most recent call last):\n  |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\_backends\\_asyncio.py\", line 763, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\runner.py\", line 341, in from_call\n    |     result: TResult | None = func()\n    |                              ^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\runner.py\", line 242, in <lambda>\n    |     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_hooks.py\", line 513, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 139, in _multicall\n    |     raise exception.with_traceback(exception.__traceback__)\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\threadexception.py\", line 92, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\threadexception.py\", line 68, in thread_exception_runtest_hook\n    |     yield\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\unraisableexception.py\", line 95, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\unraisableexception.py\", line 70, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\logging.py\", line 846, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\logging.py\", line 829, in _runtest_for\n    |     yield\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\capture.py\", line 898, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 103, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\runner.py\", line 174, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\python.py\", line 1627, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_hooks.py\", line 513, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 182, in _multicall\n    |     return outcome.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_result.py\", line 100, in get_result\n    |     raise exc.with_traceback(exc.__traceback__)\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 103, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\python.py\", line 159, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"\\\\wsl$\\Ubuntu-22.04\\home\\jj\\dev\\Novamind-Backend\\tests\\security\\test_auth_middleware.py\", line 201, in test_admin_route_with_provider_token\n    |     response = test_client.get(\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py\", line 502, in get\n    |     return super().get(\n    |            ^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 1041, in get\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 814, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 901, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 929, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 966, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 1002, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\from_thread.py\", line 290, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\concurrent\\futures\\_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\concurrent\\futures\\_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\from_thread.py\", line 221, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\fastapi\\applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"C:\\Program Files\\Python311\\Lib\\contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(typ, value, traceback)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"\\\\wsl$\\Ubuntu-22.04\\home\\jj\\dev\\Novamind-Backend\\app\\infrastructure\\security\\auth_middleware.py\", line 229, in dispatch\n    |     raise HTTPException(\n    | fastapi.exceptions.HTTPException: 401: Invalid authentication credentials\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\ntests\\security\\test_auth_middleware.py:201: in test_admin_route_with_provider_token\n    response = test_client.get(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py:502: in get\n    return super().get(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:1041: in get\n    return self.request(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py:468: in request\n    return super().request(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:814: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:901: in send\n    response = self._send_handling_auth(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:929: in _send_handling_auth\n    response = self._send_handling_redirects(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:966: in _send_handling_redirects\n    response = self._send_single_request(request)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:1002: in _send_single_request\n    response = transport.handle_request(request)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py:344: in handle_request\n    raise exc\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\from_thread.py:290: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\nC:\\Program Files\\Python311\\Lib\\concurrent\\futures\\_base.py:456: in result\n    return self.__get_result()\nC:\\Program Files\\Python311\\Lib\\concurrent\\futures\\_base.py:401: in __get_result\n    raise self._exception\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\from_thread.py:221: in _call_func\n    retval = await retval_or_awaitable\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\fastapi\\applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\errors.py:186: in __call__\n    raise exc\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py:189: in __call__\n    with collapse_excgroups():\nC:\\Program Files\\Python311\\Lib\\contextlib.py:158: in __exit__\n    self.gen.throw(typ, value, traceback)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\_utils.py:91: in collapse_excgroups\n    raise exc\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\napp\\infrastructure\\security\\auth_middleware.py:229: in dispatch\n    raise HTTPException(\nE   fastapi.exceptions.HTTPException: 401: Invalid authentication credentials\n---------------------------- Captured stderr call -----------------------------\n[REDACTED:DATE] 08:25:19,706 - jwt_service - WARNING - JWT validation error: DecodeError\n------------------------------ Captured log call ------------------------------\nWARNING  jwt_service:phi_logger.py:94 JWT validation error: DecodeError\nWARNING  app.infrastructure.security.auth_middleware:auth_middleware.py:252 Authentication error: 401 - Invalid authentication credentials\n____________ TestAuthMiddleware.test_admin_route_with_admin_token _____________\n  + Exception Group Traceback (most recent call last):\n  |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\_backends\\_asyncio.py\", line 763, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\runner.py\", line 341, in from_call\n    |     result: TResult | None = func()\n    |                              ^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\runner.py\", line 242, in <lambda>\n    |     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_hooks.py\", line 513, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 139, in _multicall\n    |     raise exception.with_traceback(exception.__traceback__)\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\threadexception.py\", line 92, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\threadexception.py\", line 68, in thread_exception_runtest_hook\n    |     yield\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\unraisableexception.py\", line 95, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\unraisableexception.py\", line 70, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\logging.py\", line 846, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\logging.py\", line 829, in _runtest_for\n    |     yield\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\capture.py\", line 898, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 103, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\runner.py\", line 174, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\python.py\", line 1627, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_hooks.py\", line 513, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 182, in _multicall\n    |     return outcome.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_result.py\", line 100, in get_result\n    |     raise exc.with_traceback(exc.__traceback__)\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 103, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\python.py\", line 159, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"\\\\wsl$\\Ubuntu-22.04\\home\\jj\\dev\\Novamind-Backend\\tests\\security\\test_auth_middleware.py\", line 212, in test_admin_route_with_admin_token\n    |     response = test_client.get(\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py\", line 502, in get\n    |     return super().get(\n    |            ^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 1041, in get\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 814, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 901, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 929, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 966, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 1002, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\from_thread.py\", line 290, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\concurrent\\futures\\_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\concurrent\\futures\\_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\from_thread.py\", line 221, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\fastapi\\applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"C:\\Program Files\\Python311\\Lib\\contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(typ, value, traceback)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"\\\\wsl$\\Ubuntu-22.04\\home\\jj\\dev\\Novamind-Backend\\app\\infrastructure\\security\\auth_middleware.py\", line 229, in dispatch\n    |     raise HTTPException(\n    | fastapi.exceptions.HTTPException: 401: Invalid authentication credentials\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\ntests\\security\\test_auth_middleware.py:212: in test_admin_route_with_admin_token\n    response = test_client.get(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py:502: in get\n    return super().get(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:1041: in get\n    return self.request(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py:468: in request\n    return super().request(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:814: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:901: in send\n    response = self._send_handling_auth(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:929: in _send_handling_auth\n    response = self._send_handling_redirects(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:966: in _send_handling_redirects\n    response = self._send_single_request(request)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:1002: in _send_single_request\n    response = transport.handle_request(request)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py:344: in handle_request\n    raise exc\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\from_thread.py:290: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\nC:\\Program Files\\Python311\\Lib\\concurrent\\futures\\_base.py:456: in result\n    return self.__get_result()\nC:\\Program Files\\Python311\\Lib\\concurrent\\futures\\_base.py:401: in __get_result\n    raise self._exception\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\from_thread.py:221: in _call_func\n    retval = await retval_or_awaitable\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\fastapi\\applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\errors.py:186: in __call__\n    raise exc\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py:189: in __call__\n    with collapse_excgroups():\nC:\\Program Files\\Python311\\Lib\\contextlib.py:158: in __exit__\n    self.gen.throw(typ, value, traceback)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\_utils.py:91: in collapse_excgroups\n    raise exc\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\napp\\infrastructure\\security\\auth_middleware.py:229: in dispatch\n    raise HTTPException(\nE   fastapi.exceptions.HTTPException: 401: Invalid authentication credentials\n---------------------------- Captured stderr call -----------------------------\n[REDACTED:DATE] 08:25:19,792 - jwt_service - WARNING - JWT validation error: DecodeError\n------------------------------ Captured log call ------------------------------\nWARNING  jwt_service:phi_logger.py:94 JWT validation error: DecodeError\nWARNING  app.infrastructure.security.auth_middleware:auth_middleware.py:252 Authentication error: 401 - Invalid authentication credentials\n____________________ TestAuthMiddleware.test_expired_token ____________________\n  + Exception Group Traceback (most recent call last):\n  |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\_backends\\_asyncio.py\", line 763, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\runner.py\", line 341, in from_call\n    |     result: TResult | None = func()\n    |                              ^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\runner.py\", line 242, in <lambda>\n    |     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_hooks.py\", line 513, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 139, in _multicall\n    |     raise exception.with_traceback(exception.__traceback__)\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\threadexception.py\", line 92, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\threadexception.py\", line 68, in thread_exception_runtest_hook\n    |     yield\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\unraisableexception.py\", line 95, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\unraisableexception.py\", line 70, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\logging.py\", line 846, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\logging.py\", line 829, in _runtest_for\n    |     yield\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\capture.py\", line 898, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 103, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\runner.py\", line 174, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\python.py\", line 1627, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_hooks.py\", line 513, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 182, in _multicall\n    |     return outcome.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_result.py\", line 100, in get_result\n    |     raise exc.with_traceback(exc.__traceback__)\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 103, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\python.py\", line 159, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"\\\\wsl$\\Ubuntu-22.04\\home\\jj\\dev\\Novamind-Backend\\tests\\security\\test_auth_middleware.py\", line 224, in test_expired_token\n    |     response = test_client.get(\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py\", line 502, in get\n    |     return super().get(\n    |            ^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 1041, in get\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 814, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 901, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 929, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 966, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 1002, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\from_thread.py\", line 290, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\concurrent\\futures\\_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\concurrent\\futures\\_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\from_thread.py\", line 221, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\fastapi\\applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"C:\\Program Files\\Python311\\Lib\\contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(typ, value, traceback)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"\\\\wsl$\\Ubuntu-22.04\\home\\jj\\dev\\Novamind-Backend\\app\\infrastructure\\security\\auth_middleware.py\", line 229, in dispatch\n    |     raise HTTPException(\n    | fastapi.exceptions.HTTPException: 401: Invalid authentication credentials\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\ntests\\security\\test_auth_middleware.py:224: in test_expired_token\n    response = test_client.get(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py:502: in get\n    return super().get(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:1041: in get\n    return self.request(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py:468: in request\n    return super().request(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:814: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:901: in send\n    response = self._send_handling_auth(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:929: in _send_handling_auth\n    response = self._send_handling_redirects(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:966: in _send_handling_redirects\n    response = self._send_single_request(request)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:1002: in _send_single_request\n    response = transport.handle_request(request)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py:344: in handle_request\n    raise exc\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\from_thread.py:290: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\nC:\\Program Files\\Python311\\Lib\\concurrent\\futures\\_base.py:456: in result\n    return self.__get_result()\nC:\\Program Files\\Python311\\Lib\\concurrent\\futures\\_base.py:401: in __get_result\n    raise self._exception\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\from_thread.py:221: in _call_func\n    retval = await retval_or_awaitable\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\fastapi\\applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\errors.py:186: in __call__\n    raise exc\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py:189: in __call__\n    with collapse_excgroups():\nC:\\Program Files\\Python311\\Lib\\contextlib.py:158: in __exit__\n    self.gen.throw(typ, value, traceback)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\_utils.py:91: in collapse_excgroups\n    raise exc\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\napp\\infrastructure\\security\\auth_middleware.py:229: in dispatch\n    raise HTTPException(\nE   fastapi.exceptions.HTTPException: 401: Invalid authentication credentials\n---------------------------- Captured stderr call -----------------------------\n[REDACTED:DATE] 08:25:19,899 - jwt_service - WARNING - JWT validation error: DecodeError\n------------------------------ Captured log call ------------------------------\nWARNING  jwt_service:phi_logger.py:94 JWT validation error: DecodeError\nWARNING  app.infrastructure.security.auth_middleware:auth_middleware.py:252 Authentication error: 401 - Invalid authentication credentials\n____________________ TestAuthMiddleware.test_invalid_token ____________________\n  + Exception Group Traceback (most recent call last):\n  |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\_backends\\_asyncio.py\", line 763, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\runner.py\", line 341, in from_call\n    |     result: TResult | None = func()\n    |                              ^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\runner.py\", line 242, in <lambda>\n    |     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_hooks.py\", line 513, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 139, in _multicall\n    |     raise exception.with_traceback(exception.__traceback__)\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\threadexception.py\", line 92, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\threadexception.py\", line 68, in thread_exception_runtest_hook\n    |     yield\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\unraisableexception.py\", line 95, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\unraisableexception.py\", line 70, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\logging.py\", line 846, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\logging.py\", line 829, in _runtest_for\n    |     yield\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\capture.py\", line 898, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 103, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\runner.py\", line 174, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\python.py\", line 1627, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_hooks.py\", line 513, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 182, in _multicall\n    |     return outcome.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_result.py\", line 100, in get_result\n    |     raise exc.with_traceback(exc.__traceback__)\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 103, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\python.py\", line 159, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"\\\\wsl$\\Ubuntu-22.04\\home\\jj\\dev\\Novamind-Backend\\tests\\security\\test_auth_middleware.py\", line 236, in test_invalid_token\n    |     response = test_client.get(\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py\", line 502, in get\n    |     return super().get(\n    |            ^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 1041, in get\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 814, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 901, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 929, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 966, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 1002, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\from_thread.py\", line 290, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\concurrent\\futures\\_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\concurrent\\futures\\_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\from_thread.py\", line 221, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\fastapi\\applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"C:\\Program Files\\Python311\\Lib\\contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(typ, value, traceback)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"\\\\wsl$\\Ubuntu-22.04\\home\\jj\\dev\\Novamind-Backend\\app\\infrastructure\\security\\auth_middleware.py\", line 229, in dispatch\n    |     raise HTTPException(\n    | fastapi.exceptions.HTTPException: 401: Invalid authentication credentials\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\ntests\\security\\test_auth_middleware.py:236: in test_invalid_token\n    response = test_client.get(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py:502: in get\n    return super().get(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:1041: in get\n    return self.request(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py:468: in request\n    return super().request(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:814: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:901: in send\n    response = self._send_handling_auth(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:929: in _send_handling_auth\n    response = self._send_handling_redirects(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:966: in _send_handling_redirects\n    response = self._send_single_request(request)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:1002: in _send_single_request\n    response = transport.handle_request(request)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py:344: in handle_request\n    raise exc\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\from_thread.py:290: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\nC:\\Program Files\\Python311\\Lib\\concurrent\\futures\\_base.py:456: in result\n    return self.__get_result()\nC:\\Program Files\\Python311\\Lib\\concurrent\\futures\\_base.py:401: in __get_result\n    raise self._exception\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\from_thread.py:221: in _call_func\n    retval = await retval_or_awaitable\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\fastapi\\applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\errors.py:186: in __call__\n    raise exc\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py:189: in __call__\n    with collapse_excgroups():\nC:\\Program Files\\Python311\\Lib\\contextlib.py:158: in __exit__\n    self.gen.throw(typ, value, traceback)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\_utils.py:91: in collapse_excgroups\n    raise exc\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\napp\\infrastructure\\security\\auth_middleware.py:229: in dispatch\n    raise HTTPException(\nE   fastapi.exceptions.HTTPException: 401: Invalid authentication credentials\n---------------------------- Captured stderr call -----------------------------\n[REDACTED:DATE] 08:25:20,010 - jwt_service - WARNING - JWT validation error: DecodeError\n------------------------------ Captured log call ------------------------------\nWARNING  jwt_service:phi_logger.py:94 JWT validation error: DecodeError\nWARNING  app.infrastructure.security.auth_middleware:auth_middleware.py:252 Authentication error: 401 - Invalid authentication credentials\n_____________ TestAuthMiddleware.test_patient_accessing_own_data ______________\n  + Exception Group Traceback (most recent call last):\n  |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\_backends\\_asyncio.py\", line 763, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\runner.py\", line 341, in from_call\n    |     result: TResult | None = func()\n    |                              ^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\runner.py\", line 242, in <lambda>\n    |     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_hooks.py\", line 513, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 139, in _multicall\n    |     raise exception.with_traceback(exception.__traceback__)\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\threadexception.py\", line 92, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\threadexception.py\", line 68, in thread_exception_runtest_hook\n    |     yield\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\unraisableexception.py\", line 95, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\unraisableexception.py\", line 70, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\logging.py\", line 846, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\logging.py\", line 829, in _runtest_for\n    |     yield\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\capture.py\", line 898, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 103, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\runner.py\", line 174, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\python.py\", line 1627, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_hooks.py\", line 513, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 182, in _multicall\n    |     return outcome.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_result.py\", line 100, in get_result\n    |     raise exc.with_traceback(exc.__traceback__)\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 103, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\python.py\", line 159, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"\\\\wsl$\\Ubuntu-22.04\\home\\jj\\dev\\Novamind-Backend\\tests\\security\\test_auth_middleware.py\", line 248, in test_patient_accessing_own_data\n    |     response = test_client.get(\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py\", line 502, in get\n    |     return super().get(\n    |            ^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 1041, in get\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 814, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 901, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 929, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 966, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 1002, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\from_thread.py\", line 290, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\concurrent\\futures\\_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\concurrent\\futures\\_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\from_thread.py\", line 221, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\fastapi\\applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"C:\\Program Files\\Python311\\Lib\\contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(typ, value, traceback)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"\\\\wsl$\\Ubuntu-22.04\\home\\jj\\dev\\Novamind-Backend\\app\\infrastructure\\security\\auth_middleware.py\", line 229, in dispatch\n    |     raise HTTPException(\n    | fastapi.exceptions.HTTPException: 401: Invalid authentication credentials\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\ntests\\security\\test_auth_middleware.py:248: in test_patient_accessing_own_data\n    response = test_client.get(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py:502: in get\n    return super().get(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:1041: in get\n    return self.request(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py:468: in request\n    return super().request(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:814: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:901: in send\n    response = self._send_handling_auth(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:929: in _send_handling_auth\n    response = self._send_handling_redirects(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:966: in _send_handling_redirects\n    response = self._send_single_request(request)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:1002: in _send_single_request\n    response = transport.handle_request(request)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py:344: in handle_request\n    raise exc\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\from_thread.py:290: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\nC:\\Program Files\\Python311\\Lib\\concurrent\\futures\\_base.py:456: in result\n    return self.__get_result()\nC:\\Program Files\\Python311\\Lib\\concurrent\\futures\\_base.py:401: in __get_result\n    raise self._exception\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\from_thread.py:221: in _call_func\n    retval = await retval_or_awaitable\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\fastapi\\applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\errors.py:186: in __call__\n    raise exc\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py:189: in __call__\n    with collapse_excgroups():\nC:\\Program Files\\Python311\\Lib\\contextlib.py:158: in __exit__\n    self.gen.throw(typ, value, traceback)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\_utils.py:91: in collapse_excgroups\n    raise exc\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\napp\\infrastructure\\security\\auth_middleware.py:229: in dispatch\n    raise HTTPException(\nE   fastapi.exceptions.HTTPException: 401: Invalid authentication credentials\n---------------------------- Captured stderr call -----------------------------\n[REDACTED:DATE] 08:25:20,096 - jwt_service - WARNING - JWT validation error: DecodeError\n------------------------------ Captured log call ------------------------------\nWARNING  jwt_service:phi_logger.py:94 JWT validation error: DecodeError\nWARNING  app.infrastructure.security.auth_middleware:auth_middleware.py:252 Authentication error: 401 - Invalid authentication credentials\n________ TestAuthMiddleware.test_patient_accessing_other_patient_data _________\n  + Exception Group Traceback (most recent call last):\n  |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\_backends\\_asyncio.py\", line 763, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\runner.py\", line 341, in from_call\n    |     result: TResult | None = func()\n    |                              ^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\runner.py\", line 242, in <lambda>\n    |     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_hooks.py\", line 513, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 139, in _multicall\n    |     raise exception.with_traceback(exception.__traceback__)\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\threadexception.py\", line 92, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\threadexception.py\", line 68, in thread_exception_runtest_hook\n    |     yield\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\unraisableexception.py\", line 95, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\unraisableexception.py\", line 70, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\logging.py\", line 846, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\logging.py\", line 829, in _runtest_for\n    |     yield\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\capture.py\", line 898, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 103, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\runner.py\", line 174, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\python.py\", line 1627, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_hooks.py\", line 513, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 182, in _multicall\n    |     return outcome.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_result.py\", line 100, in get_result\n    |     raise exc.with_traceback(exc.__traceback__)\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 103, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\python.py\", line 159, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"\\\\wsl$\\Ubuntu-22.04\\home\\jj\\dev\\Novamind-Backend\\tests\\security\\test_auth_middleware.py\", line 260, in test_patient_accessing_other_patient_data\n    |     response = test_client.get(\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py\", line 502, in get\n    |     return super().get(\n    |            ^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 1041, in get\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 814, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 901, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 929, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 966, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 1002, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\from_thread.py\", line 290, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\concurrent\\futures\\_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\concurrent\\futures\\_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\from_thread.py\", line 221, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\fastapi\\applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"C:\\Program Files\\Python311\\Lib\\contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(typ, value, traceback)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"\\\\wsl$\\Ubuntu-22.04\\home\\jj\\dev\\Novamind-Backend\\app\\infrastructure\\security\\auth_middleware.py\", line 229, in dispatch\n    |     raise HTTPException(\n    | fastapi.exceptions.HTTPException: 401: Invalid authentication credentials\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\ntests\\security\\test_auth_middleware.py:260: in test_patient_accessing_other_patient_data\n    response = test_client.get(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py:502: in get\n    return super().get(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:1041: in get\n    return self.request(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py:468: in request\n    return super().request(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:814: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:901: in send\n    response = self._send_handling_auth(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:929: in _send_handling_auth\n    response = self._send_handling_redirects(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:966: in _send_handling_redirects\n    response = self._send_single_request(request)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:1002: in _send_single_request\n    response = transport.handle_request(request)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py:344: in handle_request\n    raise exc\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\from_thread.py:290: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\nC:\\Program Files\\Python311\\Lib\\concurrent\\futures\\_base.py:456: in result\n    return self.__get_result()\nC:\\Program Files\\Python311\\Lib\\concurrent\\futures\\_base.py:401: in __get_result\n    raise self._exception\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\from_thread.py:221: in _call_func\n    retval = await retval_or_awaitable\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\fastapi\\applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\errors.py:186: in __call__\n    raise exc\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py:189: in __call__\n    with collapse_excgroups():\nC:\\Program Files\\Python311\\Lib\\contextlib.py:158: in __exit__\n    self.gen.throw(typ, value, traceback)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\_utils.py:91: in collapse_excgroups\n    raise exc\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\napp\\infrastructure\\security\\auth_middleware.py:229: in dispatch\n    raise HTTPException(\nE   fastapi.exceptions.HTTPException: 401: Invalid authentication credentials\n---------------------------- Captured stderr call -----------------------------\n[REDACTED:DATE] 08:25:20,207 - jwt_service - WARNING - JWT validation error: DecodeError\n------------------------------ Captured log call ------------------------------\nWARNING  jwt_service:phi_logger.py:94 JWT validation error: DecodeError\nWARNING  app.infrastructure.security.auth_middleware:auth_middleware.py:252 Authentication error: 401 - Invalid authentication credentials\n___________ TestAuthMiddleware.test_provider_accessing_patient_data ___________\n  + Exception Group Traceback (most recent call last):\n  |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\_backends\\_asyncio.py\", line 763, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\runner.py\", line 341, in from_call\n    |     result: TResult | None = func()\n    |                              ^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\runner.py\", line 242, in <lambda>\n    |     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_hooks.py\", line 513, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 139, in _multicall\n    |     raise exception.with_traceback(exception.__traceback__)\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\threadexception.py\", line 92, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\threadexception.py\", line 68, in thread_exception_runtest_hook\n    |     yield\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\unraisableexception.py\", line 95, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\unraisableexception.py\", line 70, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\logging.py\", line 846, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\logging.py\", line 829, in _runtest_for\n    |     yield\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\capture.py\", line 898, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 103, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\runner.py\", line 174, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\python.py\", line 1627, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_hooks.py\", line 513, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 182, in _multicall\n    |     return outcome.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_result.py\", line 100, in get_result\n    |     raise exc.with_traceback(exc.__traceback__)\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 103, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\python.py\", line 159, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"\\\\wsl$\\Ubuntu-22.04\\home\\jj\\dev\\Novamind-Backend\\tests\\security\\test_auth_middleware.py\", line 272, in test_provider_accessing_patient_data\n    |     response = test_client.get(\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py\", line 502, in get\n    |     return super().get(\n    |            ^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 1041, in get\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 814, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 901, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 929, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 966, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 1002, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\from_thread.py\", line 290, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\concurrent\\futures\\_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\concurrent\\futures\\_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\from_thread.py\", line 221, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\fastapi\\applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"C:\\Program Files\\Python311\\Lib\\contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(typ, value, traceback)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"\\\\wsl$\\Ubuntu-22.04\\home\\jj\\dev\\Novamind-Backend\\app\\infrastructure\\security\\auth_middleware.py\", line 229, in dispatch\n    |     raise HTTPException(\n    | fastapi.exceptions.HTTPException: 401: Invalid authentication credentials\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\ntests\\security\\test_auth_middleware.py:272: in test_provider_accessing_patient_data\n    response = test_client.get(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py:502: in get\n    return super().get(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:1041: in get\n    return self.request(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py:468: in request\n    return super().request(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:814: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:901: in send\n    response = self._send_handling_auth(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:929: in _send_handling_auth\n    response = self._send_handling_redirects(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:966: in _send_handling_redirects\n    response = self._send_single_request(request)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:1002: in _send_single_request\n    response = transport.handle_request(request)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py:344: in handle_request\n    raise exc\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\from_thread.py:290: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\nC:\\Program Files\\Python311\\Lib\\concurrent\\futures\\_base.py:456: in result\n    return self.__get_result()\nC:\\Program Files\\Python311\\Lib\\concurrent\\futures\\_base.py:401: in __get_result\n    raise self._exception\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\from_thread.py:221: in _call_func\n    retval = await retval_or_awaitable\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\fastapi\\applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\errors.py:186: in __call__\n    raise exc\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py:189: in __call__\n    with collapse_excgroups():\nC:\\Program Files\\Python311\\Lib\\contextlib.py:158: in __exit__\n    self.gen.throw(typ, value, traceback)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\_utils.py:91: in collapse_excgroups\n    raise exc\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\napp\\infrastructure\\security\\auth_middleware.py:229: in dispatch\n    raise HTTPException(\nE   fastapi.exceptions.HTTPException: 401: Invalid authentication credentials\n---------------------------- Captured stderr call -----------------------------\n[REDACTED:DATE] 08:25:20,294 - jwt_service - WARNING - JWT validation error: DecodeError\n------------------------------ Captured log call ------------------------------\nWARNING  jwt_service:phi_logger.py:94 JWT validation error: DecodeError\nWARNING  app.infrastructure.security.auth_middleware:auth_middleware.py:252 Authentication error: 401 - Invalid authentication credentials\n___________ TestAuthMiddleware.test_malformed_authorization_header ____________\n  + Exception Group Traceback (most recent call last):\n  |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\_backends\\_asyncio.py\", line 763, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\runner.py\", line 341, in from_call\n    |     result: TResult | None = func()\n    |                              ^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\runner.py\", line 242, in <lambda>\n    |     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_hooks.py\", line 513, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 139, in _multicall\n    |     raise exception.with_traceback(exception.__traceback__)\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\threadexception.py\", line 92, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\threadexception.py\", line 68, in thread_exception_runtest_hook\n    |     yield\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\unraisableexception.py\", line 95, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\unraisableexception.py\", line 70, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\logging.py\", line 846, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\logging.py\", line 829, in _runtest_for\n    |     yield\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\capture.py\", line 898, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 103, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\runner.py\", line 174, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\python.py\", line 1627, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_hooks.py\", line 513, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 182, in _multicall\n    |     return outcome.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_result.py\", line 100, in get_result\n    |     raise exc.with_traceback(exc.__traceback__)\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 103, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\python.py\", line 159, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"\\\\wsl$\\Ubuntu-22.04\\home\\jj\\dev\\Novamind-Backend\\tests\\security\\test_auth_middleware.py\", line 284, in test_malformed_authorization_header\n    |     response = test_client.get(\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py\", line 502, in get\n    |     return super().get(\n    |            ^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 1041, in get\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 814, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 901, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 929, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 966, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 1002, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\from_thread.py\", line 290, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\concurrent\\futures\\_base.py\", line 449, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\concurrent\\futures\\_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\from_thread.py\", line 221, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\fastapi\\applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"C:\\Program Files\\Python311\\Lib\\contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(typ, value, traceback)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"\\\\wsl$\\Ubuntu-22.04\\home\\jj\\dev\\Novamind-Backend\\app\\infrastructure\\security\\auth_middleware.py\", line 212, in dispatch\n    |     raise HTTPException(\n    | fastapi.exceptions.HTTPException: 401: Not authenticated\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\ntests\\security\\test_auth_middleware.py:284: in test_malformed_authorization_header\n    response = test_client.get(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py:502: in get\n    return super().get(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:1041: in get\n    return self.request(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py:468: in request\n    return super().request(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:814: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:901: in send\n    response = self._send_handling_auth(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:929: in _send_handling_auth\n    response = self._send_handling_redirects(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:966: in _send_handling_redirects\n    response = self._send_single_request(request)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:1002: in _send_single_request\n    response = transport.handle_request(request)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py:344: in handle_request\n    raise exc\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\from_thread.py:290: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\nC:\\Program Files\\Python311\\Lib\\concurrent\\futures\\_base.py:449: in result\n    return self.__get_result()\nC:\\Program Files\\Python311\\Lib\\concurrent\\futures\\_base.py:401: in __get_result\n    raise self._exception\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\from_thread.py:221: in _call_func\n    retval = await retval_or_awaitable\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\fastapi\\applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\errors.py:186: in __call__\n    raise exc\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py:189: in __call__\n    with collapse_excgroups():\nC:\\Program Files\\Python311\\Lib\\contextlib.py:158: in __exit__\n    self.gen.throw(typ, value, traceback)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\_utils.py:91: in collapse_excgroups\n    raise exc\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\napp\\infrastructure\\security\\auth_middleware.py:212: in dispatch\n    raise HTTPException(\nE   fastapi.exceptions.HTTPException: 401: Not authenticated\n------------------------------ Captured log call ------------------------------\nWARNING  app.infrastructure.security.auth_middleware:auth_middleware.py:252 Authentication error: 401 - Not authenticated\n____________________ TestAuthMiddleware.test_rate_limiting ____________________\ntests\\security\\test_auth_middleware.py:304: in test_rate_limiting\n    with patch.object(JWTAuthMiddleware, '_RATE_LIMIT_MAX_REQUESTS', 5), \\\nC:\\Program Files\\Python311\\Lib\\unittest\\mock.py:1443: in __enter__\n    original, local = self.get_original()\nC:\\Program Files\\Python311\\Lib\\unittest\\mock.py:1416: in get_original\n    raise AttributeError(\nE   AttributeError: <class 'app.infrastructure.security.auth_middleware.JWTAuthMiddleware'> does not have the attribute '_RATE_LIMIT_MAX_REQUESTS'\n___________________ TestAuthMiddleware.test_csrf_protection ___________________\n  + Exception Group Traceback (most recent call last):\n  |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\_backends\\_asyncio.py\", line 763, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\runner.py\", line 341, in from_call\n    |     result: TResult | None = func()\n    |                              ^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\runner.py\", line 242, in <lambda>\n    |     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_hooks.py\", line 513, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 139, in _multicall\n    |     raise exception.with_traceback(exception.__traceback__)\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\threadexception.py\", line 92, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\threadexception.py\", line 68, in thread_exception_runtest_hook\n    |     yield\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\unraisableexception.py\", line 95, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\unraisableexception.py\", line 70, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\logging.py\", line 846, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\logging.py\", line 829, in _runtest_for\n    |     yield\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\capture.py\", line 898, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 103, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\runner.py\", line 174, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\python.py\", line 1627, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_hooks.py\", line 513, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 182, in _multicall\n    |     return outcome.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_result.py\", line 100, in get_result\n    |     raise exc.with_traceback(exc.__traceback__)\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 103, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\python.py\", line 159, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"\\\\wsl$\\Ubuntu-22.04\\home\\jj\\dev\\Novamind-Backend\\tests\\security\\test_auth_middleware.py\", line 322, in test_csrf_protection\n    |     response = test_client.post(\n    |                ^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py\", line 593, in post\n    |     return super().post(\n    |            ^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 1132, in post\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 814, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 901, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 929, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 966, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 1002, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\from_thread.py\", line 290, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\concurrent\\futures\\_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\concurrent\\futures\\_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\from_thread.py\", line 221, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\fastapi\\applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"C:\\Program Files\\Python311\\Lib\\contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(typ, value, traceback)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"\\\\wsl$\\Ubuntu-22.04\\home\\jj\\dev\\Novamind-Backend\\app\\infrastructure\\security\\auth_middleware.py\", line 229, in dispatch\n    |     raise HTTPException(\n    | fastapi.exceptions.HTTPException: 401: Invalid authentication credentials\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\ntests\\security\\test_auth_middleware.py:322: in test_csrf_protection\n    response = test_client.post(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py:593: in post\n    return super().post(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:1132: in post\n    return self.request(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py:468: in request\n    return super().request(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:814: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:901: in send\n    response = self._send_handling_auth(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:929: in _send_handling_auth\n    response = self._send_handling_redirects(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:966: in _send_handling_redirects\n    response = self._send_single_request(request)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:1002: in _send_single_request\n    response = transport.handle_request(request)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py:344: in handle_request\n    raise exc\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\from_thread.py:290: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\nC:\\Program Files\\Python311\\Lib\\concurrent\\futures\\_base.py:456: in result\n    return self.__get_result()\nC:\\Program Files\\Python311\\Lib\\concurrent\\futures\\_base.py:401: in __get_result\n    raise self._exception\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\from_thread.py:221: in _call_func\n    retval = await retval_or_awaitable\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\fastapi\\applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\errors.py:186: in __call__\n    raise exc\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py:189: in __call__\n    with collapse_excgroups():\nC:\\Program Files\\Python311\\Lib\\contextlib.py:158: in __exit__\n    self.gen.throw(typ, value, traceback)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\_utils.py:91: in collapse_excgroups\n    raise exc\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\napp\\infrastructure\\security\\auth_middleware.py:229: in dispatch\n    raise HTTPException(\nE   fastapi.exceptions.HTTPException: 401: Invalid authentication credentials\n---------------------------- Captured stderr call -----------------------------\n[REDACTED:DATE] 08:25:20,540 - jwt_service - WARNING - JWT validation error: DecodeError\n------------------------------ Captured log call ------------------------------\nWARNING  jwt_service:phi_logger.py:94 JWT validation error: DecodeError\nWARNING  app.infrastructure.security.auth_middleware:auth_middleware.py:252 Authentication error: 401 - Invalid authentication credentials\n_____________ TestAuthMiddleware.test_logging_of_access_attempts ______________\n  + Exception Group Traceback (most recent call last):\n  |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\_backends\\_asyncio.py\", line 763, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\runner.py\", line 341, in from_call\n    |     result: TResult | None = func()\n    |                              ^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\runner.py\", line 242, in <lambda>\n    |     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_hooks.py\", line 513, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 139, in _multicall\n    |     raise exception.with_traceback(exception.__traceback__)\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\threadexception.py\", line 92, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\threadexception.py\", line 68, in thread_exception_runtest_hook\n    |     yield\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\unraisableexception.py\", line 95, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\unraisableexception.py\", line 70, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\logging.py\", line 846, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\logging.py\", line 829, in _runtest_for\n    |     yield\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\capture.py\", line 898, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 122, in _multicall\n    |     teardown.throw(exception)  # type: ignore[union-attr]\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 103, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\runner.py\", line 174, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\python.py\", line 1627, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_hooks.py\", line 513, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 182, in _multicall\n    |     return outcome.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_result.py\", line 100, in get_result\n    |     raise exc.with_traceback(exc.__traceback__)\n    |   File \"C:\\Program Files\\Python311\\Lib\\site-packages\\pluggy\\_callers.py\", line 103, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\_pytest\\python.py\", line 159, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"\\\\wsl$\\Ubuntu-22.04\\home\\jj\\dev\\Novamind-Backend\\tests\\security\\test_auth_middleware.py\", line 342, in test_logging_of_access_attempts\n    |     test_client.get(\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py\", line 502, in get\n    |     return super().get(\n    |            ^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 1041, in get\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 814, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 901, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 929, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 966, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py\", line 1002, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\from_thread.py\", line 290, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\concurrent\\futures\\_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Program Files\\Python311\\Lib\\concurrent\\futures\\_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\from_thread.py\", line 221, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\fastapi\\applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"C:\\Program Files\\Python311\\Lib\\contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(typ, value, traceback)\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"\\\\wsl$\\Ubuntu-22.04\\home\\jj\\dev\\Novamind-Backend\\app\\infrastructure\\security\\auth_middleware.py\", line 229, in dispatch\n    |     raise HTTPException(\n    | fastapi.exceptions.HTTPException: 401: Invalid authentication credentials\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\ntests\\security\\test_auth_middleware.py:342: in test_logging_of_access_attempts\n    test_client.get(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py:502: in get\n    return super().get(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:1041: in get\n    return self.request(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py:468: in request\n    return super().request(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:814: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:901: in send\n    response = self._send_handling_auth(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:929: in _send_handling_auth\n    response = self._send_handling_redirects(\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:966: in _send_handling_redirects\n    response = self._send_single_request(request)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\httpx\\_client.py:1002: in _send_single_request\n    response = transport.handle_request(request)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py:344: in handle_request\n    raise exc\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\from_thread.py:290: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\nC:\\Program Files\\Python311\\Lib\\concurrent\\futures\\_base.py:456: in result\n    return self.__get_result()\nC:\\Program Files\\Python311\\Lib\\concurrent\\futures\\_base.py:401: in __get_result\n    raise self._exception\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\anyio\\from_thread.py:221: in _call_func\n    retval = await retval_or_awaitable\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\fastapi\\applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\errors.py:186: in __call__\n    raise exc\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py:189: in __call__\n    with collapse_excgroups():\nC:\\Program Files\\Python311\\Lib\\contextlib.py:158: in __exit__\n    self.gen.throw(typ, value, traceback)\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\_utils.py:91: in collapse_excgroups\n    raise exc\nC:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\starlette\\middleware\\base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\napp\\infrastructure\\security\\auth_middleware.py:229: in dispatch\n    raise HTTPException(\nE   fastapi.exceptions.HTTPException: 401: Invalid authentication credentials\n---------------------------- Captured stderr call -----------------------------\n[REDACTED:DATE] 08:25:20,629 - jwt_service - WARNING - JWT validation error: DecodeError\n------------------------------ Captured log call ------------------------------\nWARNING  jwt_service:phi_logger.py:94 JWT validation error: DecodeError\nWARNING  app.infrastructure.security.auth_middleware:auth_middleware.py:252 Authentication error: 401 - Invalid authentication credentials\n=========================== short test summary info ===========================\nFAILED tests/security/test_auth_middleware.py::TestAuthMiddleware::test_patient_route_without_token\nFAILED tests/security/test_auth_middleware.py::TestAuthMiddleware::test_patient_route_with_patient_token\nFAILED tests/security/test_auth_middleware.py::TestAuthMiddleware::test_patient_route_with_provider_token\nFAILED tests/security/test_auth_middleware.py::TestAuthMiddleware::test_provider_route_with_patient_token\nFAILED tests/security/test_auth_middleware.py::TestAuthMiddleware::test_provider_route_with_provider_token\nFAILED tests/security/test_auth_middleware.py::TestAuthMiddleware::test_admin_route_with_provider_token\nFAILED tests/security/test_auth_middleware.py::TestAuthMiddleware::test_admin_route_with_admin_token\nFAILED tests/security/test_auth_middleware.py::TestAuthMiddleware::test_expired_token\nFAILED tests/security/test_auth_middleware.py::TestAuthMiddleware::test_invalid_token\nFAILED tests/security/test_auth_middleware.py::TestAuthMiddleware::test_patient_accessing_own_data\nFAILED tests/security/test_auth_middleware.py::TestAuthMiddleware::test_patient_accessing_other_patient_data\nFAILED tests/security/test_auth_middleware.py::TestAuthMiddleware::test_provider_accessing_patient_data\nFAILED tests/security/test_auth_middleware.py::TestAuthMiddleware::test_malformed_authorization_header\nFAILED tests/security/test_auth_middleware.py::TestAuthMiddleware::test_rate_limiting\nFAILED tests/security/test_auth_middleware.py::TestAuthMiddleware::test_csrf_protection\nFAILED tests/security/test_auth_middleware.py::TestAuthMiddleware::test_logging_of_access_attempts\n======================== 16 failed, 1 passed in 2.26s =========================\n",
      "stderr": "C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\pytest_asyncio\\plugin.py:207: PytestDeprecationWarning: The configuration option \"asyncio_default_fixture_loop_scope\" is unset.\nThe event loop scope for asynchronous fixtures will default to the fixture caching scope. Future versions of pytest-asyncio will default the loop scope for asynchronous fixtures to function scope. Set the default fixture loop scope explicitly in order to avoid unexpected behavior in the future. Valid fixture loop scopes are: \"function\", \"class\", \"module\", \"package\", \"session\"\n\n  warnings.warn(PytestDeprecationWarning(_DEFAULT_FIXTURE_LOOP_SCOPE_UNSET))\n"
    },
    {
      "test_file": "test_encryption.py",
      "passed": false,
      "total_tests": 18,
      "passed_tests": 7,
      "failed_tests": 2,
      "skipped_tests": 0,
      "duration": 1.7992565631866455,
      "stdout": "============================= test session starts =============================\ncollecting ... collected 8 items\n\ntests/security/test_encryption.py::TestEncryption::test_data_integrity PASSED [ 12%]\ntests/security/test_encryption.py::TestEncryption::test_dict_encryption PASSED [ 25%]\ntests/security/test_encryption.py::TestEncryption::test_empty_values PASSED [ 37%]\ntests/security/test_encryption.py::TestEncryption::test_error_handling PASSED [ 50%]\ntests/security/test_encryption.py::TestEncryption::test_field_encryption PASSED [ 62%]\ntests/security/test_encryption.py::TestEncryption::test_hipaa_compliance PASSED [ 75%]\ntests/security/test_encryption.py::TestEncryption::test_key_management FAILED [ 87%]\ntests/security/test_encryption.py::TestEncryption::test_nested_data_handling PASSED [100%]\n\n================================== FAILURES ===================================\n_____________________ TestEncryption.test_key_management ______________________\ntests\\security\\test_encryption.py:132: in test_key_management\n    self.assertEqual(len(key), 32)  # AES-256 key length\nE   AssertionError: 36 != 32\n=========================== short test summary info ===========================\nFAILED tests/security/test_encryption.py::TestEncryption::test_key_management\n========================= 1 failed, 7 passed in 0.29s =========================\n",
      "stderr": "C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\pytest_asyncio\\plugin.py:207: PytestDeprecationWarning: The configuration option \"asyncio_default_fixture_loop_scope\" is unset.\nThe event loop scope for asynchronous fixtures will default to the fixture caching scope. Future versions of pytest-asyncio will default the loop scope for asynchronous fixtures to function scope. Set the default fixture loop scope explicitly in order to avoid unexpected behavior in the future. Valid fixture loop scopes are: \"function\", \"class\", \"module\", \"package\", \"session\"\n\n  warnings.warn(PytestDeprecationWarning(_DEFAULT_FIXTURE_LOOP_SCOPE_UNSET))\n"
    },
    {
      "test_file": "test_hipaa_compliance.py",
      "passed": false,
      "total_tests": 58,
      "passed_tests": 7,
      "failed_tests": 16,
      "skipped_tests": 0,
      "duration": 2.021536111831665,
      "stdout": "============================= test session starts =============================\ncollecting ... collected 18 items\n\ntests/security/test_hipaa_compliance.py::TestPHIEncryption::test_encrypt_decrypt_phi FAILED [  5%]\ntests/security/test_hipaa_compliance.py::TestPHIEncryption::test_encrypt_field_sensitive_data FAILED [ 11%]\ntests/security/test_hipaa_compliance.py::TestPHIEncryption::test_encryption_key_requirements FAILED [ 16%]\ntests/security/test_hipaa_compliance.py::TestAuthentication::test_create_access_token PASSED [ 22%]\ntests/security/test_hipaa_compliance.py::TestAuthentication::test_decode_access_token FAILED [ 27%]\ntests/security/test_hipaa_compliance.py::TestAuthentication::test_expired_token_rejection FAILED [ 33%]\ntests/security/test_hipaa_compliance.py::TestAuthentication::test_invalid_token_rejection FAILED [ 38%]\ntests/security/test_hipaa_compliance.py::TestAuthorization::test_rbac_permission_check ERROR [ 44%]\ntests/security/test_hipaa_compliance.py::TestAuthorization::test_rbac_permission_denied ERROR [ 50%]\ntests/security/test_hipaa_compliance.py::TestAuthorization::test_cross_patient_data_access_prevented PASSED [ 55%]\ntests/security/test_hipaa_compliance.py::TestAuditLogging::test_phi_access_logging ERROR [ 61%]\ntests/security/test_hipaa_compliance.py::TestAuditLogging::test_phi_sanitization PASSED [ 66%]\ntests/security/test_hipaa_compliance.py::TestSecurityBoundaries::test_unauthorized_request_rejection PASSED [ 72%]\ntests/security/test_hipaa_compliance.py::TestSecurityBoundaries::test_phi_access_error_handling PASSED [ 77%]\ntests/security/test_hipaa_compliance.py::TestHIPAACompliance::test_field_level_encryption FAILED [ 83%]\ntests/security/test_hipaa_compliance.py::TestHIPAACompliance::test_minimum_necessary_principle PASSED [ 88%]\ntests/security/test_hipaa_compliance.py::TestHIPAACompliance::test_secure_configuration FAILED [ 94%]\ntests/security/test_hipaa_compliance.py::TestHIPAACompliance::test_password_policy PASSED [100%]\n\n=================================== ERRORS ====================================\n_______ ERROR at setup of TestAuthorization.test_rbac_permission_check ________\ntests\\security\\test_hipaa_compliance.py:148: in mock_rbac\n    with mock.patch(\"app.infrastructure.security.rbac.role_manager.check_permission\") as mock_check:\nC:\\Program Files\\Python311\\Lib\\unittest\\mock.py:1427: in __enter__\n    self.target = self.getter()\nC:\\Program Files\\Python311\\Lib\\pkgutil.py:715: in resolve_name\n    result = getattr(result, p)\nE   AttributeError: module 'app.infrastructure.security.rbac' has no attribute 'role_manager'\n_______ ERROR at setup of TestAuthorization.test_rbac_permission_denied _______\ntests\\security\\test_hipaa_compliance.py:148: in mock_rbac\n    with mock.patch(\"app.infrastructure.security.rbac.role_manager.check_permission\") as mock_check:\nC:\\Program Files\\Python311\\Lib\\unittest\\mock.py:1427: in __enter__\n    self.target = self.getter()\nC:\\Program Files\\Python311\\Lib\\pkgutil.py:715: in resolve_name\n    result = getattr(result, p)\nE   AttributeError: module 'app.infrastructure.security.rbac' has no attribute 'role_manager'\n_________ ERROR at setup of TestAuditLogging.test_phi_access_logging __________\ntests\\security\\test_hipaa_compliance.py:141: in mock_audit_logger\n    with mock.patch(\"app.infrastructure.logging.audit_logger.log_phi_access\") as mock_logger:\nC:\\Program Files\\Python311\\Lib\\unittest\\mock.py:1443: in __enter__\n    original, local = self.get_original()\nC:\\Program Files\\Python311\\Lib\\unittest\\mock.py:1416: in get_original\n    raise AttributeError(\nE   AttributeError: <module 'app.infrastructure.logging.audit_logger' from '\\\\\\\\wsl$\\\\Ubuntu-22.04\\\\home\\\\jj\\\\dev\\\\Novamind-Backend\\\\app\\\\infrastructure\\\\logging\\\\audit_logger.py'> does not have the attribute 'log_phi_access'\n================================== FAILURES ===================================\n_________________ TestPHIEncryption.test_encrypt_decrypt_phi __________________\ntests\\security\\test_hipaa_compliance.py:170: in test_encrypt_decrypt_phi\n    assert decrypted_data == test_phi_data\nE   AssertionError: assert 'decrypted_data' == {'diagnosis': 'Test Diagnosis', 'dob': '1990-01-01', 'first_name': 'Test', 'last_name': 'Patient', ...}\n_____________ TestPHIEncryption.test_encrypt_field_sensitive_data _____________\ntests\\security\\test_hipaa_compliance.py:185: in test_encrypt_field_sensitive_data\n    assert decrypted_ssn == ssn\nE   AssertionError: assert 'decrypted_field' == '123-45-6789'\nE     \nE     - 123-45-6789\nE     + decrypted_field\n_____________ TestPHIEncryption.test_encryption_key_requirements ______________\ntests\\security\\test_hipaa_compliance.py:194: in test_encryption_key_requirements\n    assert len(key) >= 32, \"Encryption key must be at least 32 characters\"\nE   AssertionError: Encryption key must be at least 32 characters\nE   assert 13 >= 32\nE    +  where 13 = len('generated_key')\n_________________ TestAuthentication.test_decode_access_token _________________\ntests\\security\\test_hipaa_compliance.py:216: in test_decode_access_token\n    assert decoded[\"sub\"] == test_user[\"username\"]\nE   AssertionError: assert 'test_user' == 'test_user_7ce57d97'\nE     \nE     - test_user_7ce57d97\nE     + test_user\n_______________ TestAuthentication.test_expired_token_rejection _______________\ntests\\security\\test_hipaa_compliance.py:231: in test_expired_token_rejection\n    with pytest.raises((jwt.JWTError, AuthenticationError)):\nE   Failed: DID NOT RAISE (<class 'jose.exceptions.JWTError'>, <class 'test_hipaa_compliance.AuthenticationError'>)\n_______________ TestAuthentication.test_invalid_token_rejection _______________\ntests\\security\\test_hipaa_compliance.py:240: in test_invalid_token_rejection\n    with pytest.raises((jwt.JWTError, AuthenticationError)):\nE   Failed: DID NOT RAISE (<class 'jose.exceptions.JWTError'>, <class 'test_hipaa_compliance.AuthenticationError'>)\n_______________ TestHIPAACompliance.test_field_level_encryption _______________\ntests\\security\\test_hipaa_compliance.py:360: in test_field_level_encryption\n    assert decrypted == value\nE   AssertionError: assert 'decrypted_field' == '123-45-6789'\nE     \nE     - 123-45-6789\nE     + decrypted_field\n________________ TestHIPAACompliance.test_secure_configuration ________________\ntests\\security\\test_hipaa_compliance.py:385: in test_secure_configuration\n    assert settings.USE_TLS is True\nE   AssertionError: assert <MagicMock name='mock.USE_TLS' id='2437303176848'> is True\nE    +  where <MagicMock name='mock.USE_TLS' id='2437303176848'> = <MagicMock id='2437300526608'>.USE_TLS\n=========================== short test summary info ===========================\nFAILED tests/security/test_hipaa_compliance.py::TestPHIEncryption::test_encrypt_decrypt_phi\nFAILED tests/security/test_hipaa_compliance.py::TestPHIEncryption::test_encrypt_field_sensitive_data\nFAILED tests/security/test_hipaa_compliance.py::TestPHIEncryption::test_encryption_key_requirements\nFAILED tests/security/test_hipaa_compliance.py::TestAuthentication::test_decode_access_token\nFAILED tests/security/test_hipaa_compliance.py::TestAuthentication::test_expired_token_rejection\nFAILED tests/security/test_hipaa_compliance.py::TestAuthentication::test_invalid_token_rejection\nFAILED tests/security/test_hipaa_compliance.py::TestHIPAACompliance::test_field_level_encryption\nFAILED tests/security/test_hipaa_compliance.py::TestHIPAACompliance::test_secure_configuration\nERROR tests/security/test_hipaa_compliance.py::TestAuthorization::test_rbac_permission_check\nERROR tests/security/test_hipaa_compliance.py::TestAuthorization::test_rbac_permission_denied\nERROR tests/security/test_hipaa_compliance.py::TestAuditLogging::test_phi_access_logging\n==================== 8 failed, 7 passed, 3 errors in 0.54s ====================\n",
      "stderr": "C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\pytest_asyncio\\plugin.py:207: PytestDeprecationWarning: The configuration option \"asyncio_default_fixture_loop_scope\" is unset.\nThe event loop scope for asynchronous fixtures will default to the fixture caching scope. Future versions of pytest-asyncio will default the loop scope for asynchronous fixtures to function scope. Set the default fixture loop scope explicitly in order to avoid unexpected behavior in the future. Valid fixture loop scopes are: \"function\", \"class\", \"module\", \"package\", \"session\"\n\n  warnings.warn(PytestDeprecationWarning(_DEFAULT_FIXTURE_LOOP_SCOPE_UNSET))\n"
    },
    {
      "test_file": "test_jwt_auth.py",
      "passed": true,
      "total_tests": 16,
      "passed_tests": 0,
      "failed_tests": 0,
      "skipped_tests": 8,
      "duration": 1.6503400802612305,
      "stdout": "============================= test session starts =============================\ncollecting ... collected 8 items\n\ntests/security/test_jwt_auth.py::TestJWTAuthentication::test_token_creation SKIPPED [ 12%]\ntests/security/test_jwt_auth.py::TestJWTAuthentication::test_token_validation SKIPPED [ 25%]\ntests/security/test_jwt_auth.py::TestJWTAuthentication::test_role_based_access SKIPPED [ 37%]\ntests/security/test_jwt_auth.py::TestJWTAuthentication::test_token_from_request SKIPPED [ 50%]\ntests/security/test_jwt_auth.py::TestJWTAuthentication::test_unauthorized_response SKIPPED [ 62%]\ntests/security/test_jwt_auth.py::TestJWTAuthentication::test_refresh_token SKIPPED [ 75%]\ntests/security/test_jwt_auth.py::TestJWTAuthentication::test_hipaa_compliance_in_errors SKIPPED [ 87%]\ntests/security/test_jwt_auth.py::TestJWTAuthentication::test_token_security_properties SKIPPED [100%]\n\n============================= 8 skipped in 0.17s ==============================\n",
      "stderr": "C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\pytest_asyncio\\plugin.py:207: PytestDeprecationWarning: The configuration option \"asyncio_default_fixture_loop_scope\" is unset.\nThe event loop scope for asynchronous fixtures will default to the fixture caching scope. Future versions of pytest-asyncio will default the loop scope for asynchronous fixtures to function scope. Set the default fixture loop scope explicitly in order to avoid unexpected behavior in the future. Valid fixture loop scopes are: \"function\", \"class\", \"module\", \"package\", \"session\"\n\n  warnings.warn(PytestDeprecationWarning(_DEFAULT_FIXTURE_LOOP_SCOPE_UNSET))\n"
    },
    {
      "test_file": "test_jwt_service.py",
      "passed": true,
      "total_tests": 22,
      "passed_tests": 11,
      "failed_tests": 0,
      "skipped_tests": 0,
      "duration": 1.7582767009735107,
      "stdout": "============================= test session starts =============================\ncollecting ... collected 11 items\n\ntests/security/test_jwt_service.py::TestJWTService::test_create_access_token_no_phi PASSED [  9%]\ntests/security/test_jwt_service.py::TestJWTService::test_create_access_token_expiration PASSED [ 18%]\ntests/security/test_jwt_service.py::TestJWTService::test_verify_token_valid PASSED [ 27%]\ntests/security/test_jwt_service.py::TestJWTService::test_verify_token_expired PASSED [ 36%]\ntests/security/test_jwt_service.py::TestJWTService::test_verify_token_invalid_signature PASSED [ 45%]\ntests/security/test_jwt_service.py::TestJWTService::test_verify_token_invalid_format PASSED [ 54%]\ntests/security/test_jwt_service.py::TestJWTService::test_admin_role_permissions PASSED [ 63%]\ntests/security/test_jwt_service.py::TestJWTService::test_provider_role_permissions PASSED [ 72%]\ntests/security/test_jwt_service.py::TestJWTService::test_patient_role_permissions PASSED [ 81%]\ntests/security/test_jwt_service.py::TestJWTService::test_refresh_token_rotation PASSED [ 90%]\ntests/security/test_jwt_service.py::TestJWTService::test_refresh_token_family_tracking PASSED [100%]\n\n============================= 11 passed in 0.25s ==============================\n",
      "stderr": "C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\pytest_asyncio\\plugin.py:207: PytestDeprecationWarning: The configuration option \"asyncio_default_fixture_loop_scope\" is unset.\nThe event loop scope for asynchronous fixtures will default to the fixture caching scope. Future versions of pytest-asyncio will default the loop scope for asynchronous fixtures to function scope. Set the default fixture loop scope explicitly in order to avoid unexpected behavior in the future. Valid fixture loop scopes are: \"function\", \"class\", \"module\", \"package\", \"session\"\n\n  warnings.warn(PytestDeprecationWarning(_DEFAULT_FIXTURE_LOOP_SCOPE_UNSET))\n"
    },
    {
      "test_file": "test_log_sanitizer.py",
      "passed": false,
      "total_tests": 0,
      "passed_tests": 0,
      "failed_tests": 0,
      "skipped_tests": 0,
      "duration": 1.7317800521850586,
      "stdout": "============================= test session starts =============================\ncollecting ... collected 0 items / 1 error\n\n=================================== ERRORS ====================================\n____________ ERROR collecting tests/security/test_log_sanitizer.py ____________\nImportError while importing test module '\\\\wsl$\\Ubuntu-22.04\\home\\jj\\dev\\Novamind-Backend\\tests\\security\\test_log_sanitizer.py'.\nHint: make sure your test modules/packages have valid Python names.\nTraceback:\nC:\\Program Files\\Python311\\Lib\\importlib\\__init__.py:126: in import_module\n    return _bootstrap._gcd_import(name[level:], package, level)\nC:\\Program Files\\Python311\\Lib\\site-packages\\ddtrace\\internal\\module.py:295: in _exec_module\n    self.loader.exec_module(module)\ntests\\security\\test_log_sanitizer.py:4: in <module>\n    from app.infrastructure.security.log_sanitizer import LogSanitizer\nE   ImportError: cannot import name 'LogSanitizer' from 'app.infrastructure.security.log_sanitizer' (\\\\wsl$\\Ubuntu-22.04\\home\\jj\\dev\\Novamind-Backend\\app\\infrastructure\\security\\log_sanitizer.py)\n=========================== short test summary info ===========================\nERROR tests/security/test_log_sanitizer.py\n!!!!!!!!!!!!!!!!!!! Interrupted: 1 error during collection !!!!!!!!!!!!!!!!!!!!\n============================== 1 error in 0.26s ===============================\n",
      "stderr": "C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\pytest_asyncio\\plugin.py:207: PytestDeprecationWarning: The configuration option \"asyncio_default_fixture_loop_scope\" is unset.\nThe event loop scope for asynchronous fixtures will default to the fixture caching scope. Future versions of pytest-asyncio will default the loop scope for asynchronous fixtures to function scope. Set the default fixture loop scope explicitly in order to avoid unexpected behavior in the future. Valid fixture loop scopes are: \"function\", \"class\", \"module\", \"package\", \"session\"\n\n  warnings.warn(PytestDeprecationWarning(_DEFAULT_FIXTURE_LOOP_SCOPE_UNSET))\n"
    },
    {
      "test_file": "test_ml_encryption.py",
      "passed": false,
      "total_tests": 0,
      "passed_tests": 0,
      "failed_tests": 0,
      "skipped_tests": 0,
      "duration": 1.8152623176574707,
      "stdout": "============================= test session starts =============================\ncollecting ... collected 0 items / 1 error\n\n=================================== ERRORS ====================================\n____________ ERROR collecting tests/security/test_ml_encryption.py ____________\nImportError while importing test module '\\\\wsl$\\Ubuntu-22.04\\home\\jj\\dev\\Novamind-Backend\\tests\\security\\test_ml_encryption.py'.\nHint: make sure your test modules/packages have valid Python names.\nTraceback:\nC:\\Program Files\\Python311\\Lib\\importlib\\__init__.py:126: in import_module\n    return _bootstrap._gcd_import(name[level:], package, level)\nC:\\Program Files\\Python311\\Lib\\site-packages\\ddtrace\\internal\\module.py:295: in _exec_module\n    self.loader.exec_module(module)\ntests\\security\\test_ml_encryption.py:7: in <module>\n    from app.infrastructure.security.encryption import EncryptionService, FieldEncryptor\nE   ImportError: cannot import name 'FieldEncryptor' from 'app.infrastructure.security.encryption' (\\\\wsl$\\Ubuntu-22.04\\home\\jj\\dev\\Novamind-Backend\\app\\infrastructure\\security\\encryption.py)\n=========================== short test summary info ===========================\nERROR tests/security/test_ml_encryption.py\n!!!!!!!!!!!!!!!!!!! Interrupted: 1 error during collection !!!!!!!!!!!!!!!!!!!!\n============================== 1 error in 0.35s ===============================\n",
      "stderr": "C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\pytest_asyncio\\plugin.py:207: PytestDeprecationWarning: The configuration option \"asyncio_default_fixture_loop_scope\" is unset.\nThe event loop scope for asynchronous fixtures will default to the fixture caching scope. Future versions of pytest-asyncio will default the loop scope for asynchronous fixtures to function scope. Set the default fixture loop scope explicitly in order to avoid unexpected behavior in the future. Valid fixture loop scopes are: \"function\", \"class\", \"module\", \"package\", \"session\"\n\n  warnings.warn(PytestDeprecationWarning(_DEFAULT_FIXTURE_LOOP_SCOPE_UNSET))\n"
    },
    {
      "test_file": "test_ml_phi_security.py",
      "passed": false,
      "total_tests": 0,
      "passed_tests": 0,
      "failed_tests": 0,
      "skipped_tests": 0,
      "duration": 1.7234959602355957,
      "stdout": "============================= test session starts =============================\ncollecting ... collected 0 items / 1 error\n\n=================================== ERRORS ====================================\n___________ ERROR collecting tests/security/test_ml_phi_security.py ___________\nImportError while importing test module '\\\\wsl$\\Ubuntu-22.04\\home\\jj\\dev\\Novamind-Backend\\tests\\security\\test_ml_phi_security.py'.\nHint: make sure your test modules/packages have valid Python names.\nTraceback:\nC:\\Program Files\\Python311\\Lib\\importlib\\__init__.py:126: in import_module\n    return _bootstrap._gcd_import(name[level:], package, level)\nC:\\Program Files\\Python311\\Lib\\site-packages\\ddtrace\\internal\\module.py:295: in _exec_module\n    self.loader.exec_module(module)\ntests\\security\\test_ml_phi_security.py:15: in <module>\n    from app.infrastructure.ml.data_processing import PHIProcessor\nE   ModuleNotFoundError: No module named 'app.infrastructure.ml.data_processing'\n=========================== short test summary info ===========================\nERROR tests/security/test_ml_phi_security.py\n!!!!!!!!!!!!!!!!!!! Interrupted: 1 error during collection !!!!!!!!!!!!!!!!!!!!\n============================== 1 error in 0.26s ===============================\n",
      "stderr": "C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\pytest_asyncio\\plugin.py:207: PytestDeprecationWarning: The configuration option \"asyncio_default_fixture_loop_scope\" is unset.\nThe event loop scope for asynchronous fixtures will default to the fixture caching scope. Future versions of pytest-asyncio will default the loop scope for asynchronous fixtures to function scope. Set the default fixture loop scope explicitly in order to avoid unexpected behavior in the future. Valid fixture loop scopes are: \"function\", \"class\", \"module\", \"package\", \"session\"\n\n  warnings.warn(PytestDeprecationWarning(_DEFAULT_FIXTURE_LOOP_SCOPE_UNSET))\n"
    },
    {
      "test_file": "test_phi_middleware.py",
      "passed": true,
      "total_tests": 14,
      "passed_tests": 0,
      "failed_tests": 0,
      "skipped_tests": 7,
      "duration": 1.6498947143554688,
      "stdout": "============================= test session starts =============================\ncollecting ... collected 7 items\n\ntests/security/test_phi_middleware.py::TestPHIMiddleware::test_detects_phi_in_text SKIPPED [ 14%]\ntests/security/test_phi_middleware.py::TestPHIMiddleware::test_redacts_phi_from_text SKIPPED [ 28%]\ntests/security/test_phi_middleware.py::TestPHIMiddleware::test_sanitizes_log_message SKIPPED [ 42%]\ntests/security/test_phi_middleware.py::TestPHIMiddleware::test_sanitizes_error_response SKIPPED [ 57%]\ntests/security/test_phi_middleware.py::TestPHIMiddleware::test_sanitizes_request_logs SKIPPED [ 71%]\ntests/security/test_phi_middleware.py::TestPHIMiddleware::test_handles_nested_phi SKIPPED [ 85%]\ntests/security/test_phi_middleware.py::TestPHIMiddleware::test_preserves_non_phi SKIPPED [100%]\n\n============================= 7 skipped in 0.16s ==============================\n",
      "stderr": "C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\pytest_asyncio\\plugin.py:207: PytestDeprecationWarning: The configuration option \"asyncio_default_fixture_loop_scope\" is unset.\nThe event loop scope for asynchronous fixtures will default to the fixture caching scope. Future versions of pytest-asyncio will default the loop scope for asynchronous fixtures to function scope. Set the default fixture loop scope explicitly in order to avoid unexpected behavior in the future. Valid fixture loop scopes are: \"function\", \"class\", \"module\", \"package\", \"session\"\n\n  warnings.warn(PytestDeprecationWarning(_DEFAULT_FIXTURE_LOOP_SCOPE_UNSET))\n"
    },
    {
      "test_file": "test_repository_security.py",
      "passed": false,
      "total_tests": 20,
      "passed_tests": 0,
      "failed_tests": 0,
      "skipped_tests": 0,
      "duration": 2.775319814682007,
      "stdout": "============================= test session starts =============================\ncollecting ... collected 10 items\n\ntests/security/test_repository_security.py::test_patient_creation_encrypts_phi ERROR [ 10%]\ntests/security/test_repository_security.py::test_patient_retrieval_decrypts_phi ERROR [ 20%]\ntests/security/test_repository_security.py::test_repository_filters_inactive_records ERROR [ 30%]\ntests/security/test_repository_security.py::test_audit_logging_on_patient_changes ERROR [ 40%]\ntests/security/test_repository_security.py::test_authorization_check_before_operations ERROR [ 50%]\ntests/security/test_repository_security.py::test_phi_never_appears_in_exceptions ERROR [ 60%]\ntests/security/test_repository_security.py::test_bulk_operations_maintain_encryption ERROR [ 70%]\ntests/security/test_repository_security.py::test_search_filters_without_exposing_phi ERROR [ 80%]\ntests/security/test_repository_security.py::test_encryption_key_rotation ERROR [ 90%]\ntests/security/test_repository_security.py::test_field_level_encryption ERROR [100%]\n\n=================================== ERRORS ====================================\n____________ ERROR at setup of test_patient_creation_encrypts_phi _____________\ntests\\security\\test_repository_security.py:29: in encryption_service\n    with patch.object(service, '_load_encryption_key') as mock_load:\nC:\\Program Files\\Python311\\Lib\\unittest\\mock.py:1443: in __enter__\n    original, local = self.get_original()\nC:\\Program Files\\Python311\\Lib\\unittest\\mock.py:1416: in get_original\n    raise AttributeError(\nE   AttributeError: <app.infrastructure.security.encryption_service.EncryptionService object at 0x000001DBC8FD6ED0> does not have the attribute '_load_encryption_key'\n----------------------------- Captured log setup ------------------------------\nWARNING  encryption_service:encryption_service.py:54 No encryption key provided or found in environment. Generated a new one. This should be stored securely.\nWARNING  encryption_service:encryption_service.py:69 No encryption salt provided or found in environment. Generated a new one. This should be stored securely.\n____________ ERROR at setup of test_patient_retrieval_decrypts_phi ____________\ntests\\security\\test_repository_security.py:29: in encryption_service\n    with patch.object(service, '_load_encryption_key') as mock_load:\nC:\\Program Files\\Python311\\Lib\\unittest\\mock.py:1443: in __enter__\n    original, local = self.get_original()\nC:\\Program Files\\Python311\\Lib\\unittest\\mock.py:1416: in get_original\n    raise AttributeError(\nE   AttributeError: <app.infrastructure.security.encryption_service.EncryptionService object at 0x000001DBC914D490> does not have the attribute '_load_encryption_key'\n----------------------------- Captured log setup ------------------------------\nWARNING  encryption_service:encryption_service.py:54 No encryption key provided or found in environment. Generated a new one. This should be stored securely.\nWARNING  encryption_service:encryption_service.py:69 No encryption salt provided or found in environment. Generated a new one. This should be stored securely.\n_________ ERROR at setup of test_repository_filters_inactive_records __________\ntests\\security\\test_repository_security.py:29: in encryption_service\n    with patch.object(service, '_load_encryption_key') as mock_load:\nC:\\Program Files\\Python311\\Lib\\unittest\\mock.py:1443: in __enter__\n    original, local = self.get_original()\nC:\\Program Files\\Python311\\Lib\\unittest\\mock.py:1416: in get_original\n    raise AttributeError(\nE   AttributeError: <app.infrastructure.security.encryption_service.EncryptionService object at 0x000001DBC91D1AD0> does not have the attribute '_load_encryption_key'\n----------------------------- Captured log setup ------------------------------\nWARNING  encryption_service:encryption_service.py:54 No encryption key provided or found in environment. Generated a new one. This should be stored securely.\nWARNING  encryption_service:encryption_service.py:69 No encryption salt provided or found in environment. Generated a new one. This should be stored securely.\n___________ ERROR at setup of test_audit_logging_on_patient_changes ___________\ntests\\security\\test_repository_security.py:29: in encryption_service\n    with patch.object(service, '_load_encryption_key') as mock_load:\nC:\\Program Files\\Python311\\Lib\\unittest\\mock.py:1443: in __enter__\n    original, local = self.get_original()\nC:\\Program Files\\Python311\\Lib\\unittest\\mock.py:1416: in get_original\n    raise AttributeError(\nE   AttributeError: <app.infrastructure.security.encryption_service.EncryptionService object at 0x000001DBC920FA10> does not have the attribute '_load_encryption_key'\n----------------------------- Captured log setup ------------------------------\nWARNING  encryption_service:encryption_service.py:54 No encryption key provided or found in environment. Generated a new one. This should be stored securely.\nWARNING  encryption_service:encryption_service.py:69 No encryption salt provided or found in environment. Generated a new one. This should be stored securely.\n________ ERROR at setup of test_authorization_check_before_operations _________\ntests\\security\\test_repository_security.py:29: in encryption_service\n    with patch.object(service, '_load_encryption_key') as mock_load:\nC:\\Program Files\\Python311\\Lib\\unittest\\mock.py:1443: in __enter__\n    original, local = self.get_original()\nC:\\Program Files\\Python311\\Lib\\unittest\\mock.py:1416: in get_original\n    raise AttributeError(\nE   AttributeError: <app.infrastructure.security.encryption_service.EncryptionService object at 0x000001DBC915D490> does not have the attribute '_load_encryption_key'\n----------------------------- Captured log setup ------------------------------\nWARNING  encryption_service:encryption_service.py:54 No encryption key provided or found in environment. Generated a new one. This should be stored securely.\nWARNING  encryption_service:encryption_service.py:69 No encryption salt provided or found in environment. Generated a new one. This should be stored securely.\n___________ ERROR at setup of test_phi_never_appears_in_exceptions ____________\ntests\\security\\test_repository_security.py:29: in encryption_service\n    with patch.object(service, '_load_encryption_key') as mock_load:\nC:\\Program Files\\Python311\\Lib\\unittest\\mock.py:1443: in __enter__\n    original, local = self.get_original()\nC:\\Program Files\\Python311\\Lib\\unittest\\mock.py:1416: in get_original\n    raise AttributeError(\nE   AttributeError: <app.infrastructure.security.encryption_service.EncryptionService object at 0x000001DBC91A0AD0> does not have the attribute '_load_encryption_key'\n----------------------------- Captured log setup ------------------------------\nWARNING  encryption_service:encryption_service.py:54 No encryption key provided or found in environment. Generated a new one. This should be stored securely.\nWARNING  encryption_service:encryption_service.py:69 No encryption salt provided or found in environment. Generated a new one. This should be stored securely.\n_________ ERROR at setup of test_bulk_operations_maintain_encryption __________\ntests\\security\\test_repository_security.py:29: in encryption_service\n    with patch.object(service, '_load_encryption_key') as mock_load:\nC:\\Program Files\\Python311\\Lib\\unittest\\mock.py:1443: in __enter__\n    original, local = self.get_original()\nC:\\Program Files\\Python311\\Lib\\unittest\\mock.py:1416: in get_original\n    raise AttributeError(\nE   AttributeError: <app.infrastructure.security.encryption_service.EncryptionService object at 0x000001DBC9210990> does not have the attribute '_load_encryption_key'\n----------------------------- Captured log setup ------------------------------\nWARNING  encryption_service:encryption_service.py:54 No encryption key provided or found in environment. Generated a new one. This should be stored securely.\nWARNING  encryption_service:encryption_service.py:69 No encryption salt provided or found in environment. Generated a new one. This should be stored securely.\n_________ ERROR at setup of test_search_filters_without_exposing_phi __________\ntests\\security\\test_repository_security.py:29: in encryption_service\n    with patch.object(service, '_load_encryption_key') as mock_load:\nC:\\Program Files\\Python311\\Lib\\unittest\\mock.py:1443: in __enter__\n    original, local = self.get_original()\nC:\\Program Files\\Python311\\Lib\\unittest\\mock.py:1416: in get_original\n    raise AttributeError(\nE   AttributeError: <app.infrastructure.security.encryption_service.EncryptionService object at 0x000001DBC8FB78D0> does not have the attribute '_load_encryption_key'\n----------------------------- Captured log setup ------------------------------\nWARNING  encryption_service:encryption_service.py:54 No encryption key provided or found in environment. Generated a new one. This should be stored securely.\nWARNING  encryption_service:encryption_service.py:69 No encryption salt provided or found in environment. Generated a new one. This should be stored securely.\n_______________ ERROR at setup of test_encryption_key_rotation ________________\ntests\\security\\test_repository_security.py:29: in encryption_service\n    with patch.object(service, '_load_encryption_key') as mock_load:\nC:\\Program Files\\Python311\\Lib\\unittest\\mock.py:1443: in __enter__\n    original, local = self.get_original()\nC:\\Program Files\\Python311\\Lib\\unittest\\mock.py:1416: in get_original\n    raise AttributeError(\nE   AttributeError: <app.infrastructure.security.encryption_service.EncryptionService object at 0x000001DBC9223DD0> does not have the attribute '_load_encryption_key'\n----------------------------- Captured log setup ------------------------------\nWARNING  encryption_service:encryption_service.py:54 No encryption key provided or found in environment. Generated a new one. This should be stored securely.\nWARNING  encryption_service:encryption_service.py:69 No encryption salt provided or found in environment. Generated a new one. This should be stored securely.\n________________ ERROR at setup of test_field_level_encryption ________________\ntests\\security\\test_repository_security.py:29: in encryption_service\n    with patch.object(service, '_load_encryption_key') as mock_load:\nC:\\Program Files\\Python311\\Lib\\unittest\\mock.py:1443: in __enter__\n    original, local = self.get_original()\nC:\\Program Files\\Python311\\Lib\\unittest\\mock.py:1416: in get_original\n    raise AttributeError(\nE   AttributeError: <app.infrastructure.security.encryption_service.EncryptionService object at 0x000001DBC84901D0> does not have the attribute '_load_encryption_key'\n----------------------------- Captured log setup ------------------------------\nWARNING  encryption_service:encryption_service.py:54 No encryption key provided or found in environment. Generated a new one. This should be stored securely.\nWARNING  encryption_service:encryption_service.py:69 No encryption salt provided or found in environment. Generated a new one. This should be stored securely.\n=========================== short test summary info ===========================\nERROR tests/security/test_repository_security.py::test_patient_creation_encrypts_phi\nERROR tests/security/test_repository_security.py::test_patient_retrieval_decrypts_phi\nERROR tests/security/test_repository_security.py::test_repository_filters_inactive_records\nERROR tests/security/test_repository_security.py::test_audit_logging_on_patient_changes\nERROR tests/security/test_repository_security.py::test_authorization_check_before_operations\nERROR tests/security/test_repository_security.py::test_phi_never_appears_in_exceptions\nERROR tests/security/test_repository_security.py::test_bulk_operations_maintain_encryption\nERROR tests/security/test_repository_security.py::test_search_filters_without_exposing_phi\nERROR tests/security/test_repository_security.py::test_encryption_key_rotation\nERROR tests/security/test_repository_security.py::test_field_level_encryption\n============================= 10 errors in 1.25s ==============================\n",
      "stderr": "C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\pytest_asyncio\\plugin.py:207: PytestDeprecationWarning: The configuration option \"asyncio_default_fixture_loop_scope\" is unset.\nThe event loop scope for asynchronous fixtures will default to the fixture caching scope. Future versions of pytest-asyncio will default the loop scope for asynchronous fixtures to function scope. Set the default fixture loop scope explicitly in order to avoid unexpected behavior in the future. Valid fixture loop scopes are: \"function\", \"class\", \"module\", \"package\", \"session\"\n\n  warnings.warn(PytestDeprecationWarning(_DEFAULT_FIXTURE_LOOP_SCOPE_UNSET))\n"
    },
    {
      "test_file": "test_unit_of_work.py",
      "passed": false,
      "total_tests": 0,
      "passed_tests": 0,
      "failed_tests": 0,
      "skipped_tests": 0,
      "duration": 2.098069667816162,
      "stdout": "============================= test session starts =============================\ncollecting ... collected 0 items / 1 error\n\n=================================== ERRORS ====================================\n____________ ERROR collecting tests/security/test_unit_of_work.py _____________\nImportError while importing test module '\\\\wsl$\\Ubuntu-22.04\\home\\jj\\dev\\Novamind-Backend\\tests\\security\\test_unit_of_work.py'.\nHint: make sure your test modules/packages have valid Python names.\nTraceback:\nC:\\Program Files\\Python311\\Lib\\importlib\\__init__.py:126: in import_module\n    return _bootstrap._gcd_import(name[level:], package, level)\nC:\\Program Files\\Python311\\Lib\\site-packages\\ddtrace\\internal\\module.py:295: in _exec_module\n    self.loader.exec_module(module)\ntests\\security\\test_unit_of_work.py:6: in <module>\n    from app.domain.exceptions import TransactionError\nE   ImportError: cannot import name 'TransactionError' from 'app.domain.exceptions' (\\\\wsl$\\Ubuntu-22.04\\home\\jj\\dev\\Novamind-Backend\\app\\domain\\exceptions\\__init__.py)\n=========================== short test summary info ===========================\nERROR tests/security/test_unit_of_work.py\n!!!!!!!!!!!!!!!!!!! Interrupted: 1 error during collection !!!!!!!!!!!!!!!!!!!!\n============================== 1 error in 0.60s ===============================\n",
      "stderr": "C:\\Users\\JJ\\AppData\\Roaming\\Python\\Python311\\site-packages\\pytest_asyncio\\plugin.py:207: PytestDeprecationWarning: The configuration option \"asyncio_default_fixture_loop_scope\" is unset.\nThe event loop scope for asynchronous fixtures will default to the fixture caching scope. Future versions of pytest-asyncio will default the loop scope for asynchronous fixtures to function scope. Set the default fixture loop scope explicitly in order to avoid unexpected behavior in the future. Valid fixture loop scopes are: \"function\", \"class\", \"module\", \"package\", \"session\"\n\n  warnings.warn(PytestDeprecationWarning(_DEFAULT_FIXTURE_LOOP_SCOPE_UNSET))\n"
    }
  ],
  "summary": {
    "total_files": 13,
    "passed_files": 4,
    "total_tests": 224,
    "passed_tests": 26,
    "failed_tests": 50,
    "skipped_tests": 20,
    "total_duration": 26.665143728256226
  }
}